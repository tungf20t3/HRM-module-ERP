<![CDATA[if @type = '0' delete @@table from @@table a where exists(select 1 from cdhd b where a.ma_dvcs = b.ma_dvcs and a.tk = b.tk and a.ma_hd = b.ma_hd and b.nam = @year and a.ma_kh = b.ma_kh)
select a.* into #k from @@table a join cdhd b on a.ma_dvcs = b.ma_dvcs and a.tk = b.tk and a.ma_hd = b.ma_hd and a.ma_kh = b.ma_kh where b.nam = @year
delete @@table from @@table a where exists(select 1 from #k b where a.ma_dvcs = b.ma_dvcs and a.tk = b.tk and a.ma_hd = b.ma_hd and a.ma_kh = b.ma_kh)]]>