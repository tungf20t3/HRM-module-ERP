<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE grid [
  <!ENTITY XMLGetUOMConversion SYSTEM "..\Include\XML\GetUOMConversion.xml">
  <!ENTITY XMLStandardDetailToolbar SYSTEM "..\Include\XML\StandardDetailToolbar.xml">
]>

<grid table="dnl$000000" code="stt_rec" order="stt_rec, line_nbr" type="Detail" freezeColumns="3" id="NL1" uniKey="true" xmlns="urn:schemas-ai-erp:data-grid">
  <title v="" e=""></title>
  <subTitle v="" e=""></subTitle>
  <partition table="cnl$000000" prime="dnl$" inquiry="inl$" field="ngay_ct" expression="convert(char(6), {0}, 112)" increase="dateadd(month, 1, {0})" default="000000"/>
  <fields>
    <field name="ma_nv" width="100" aliasName="b">
      <header v="Mã nhân viên" e="Employee ID"></header>
      <items style="AutoComplete" controller="hrEmployee" reference="ten" key="bp_ref like case when '{[$bp_ref]}' &lt;&gt; '' then '{[$bp_ref]}%' else '''' end and status = '1'" check="bp_ref like case when '{[$bp_ref]}' &lt;&gt; '' then '{[$bp_ref]}%' else '''' end" information="ma_nv$vhrnv.ten"/>
      <clientScript><![CDATA[onchange="onchange$GridVoucherDetail$EmployeeID(this);"]]></clientScript>
    </field>
    <field name="ten" readOnly="true" external="true" defaultValue="''" inactivate="true" width="200" aliasName="b">
      <header v="Họ và tên" e="Employee Name"></header>
    </field>
    <field name="stt_rec_nv" readOnly="true" hidden="true" aliasName="a">
      <header v="" e=""></header>
    </field>

    <field name="nd_01" width="200">
      <header v="" e=""></header>
    </field>
    <field name="nd_02" width="200">
      <header v="" e=""></header>
    </field>
    <field name="nd_03" width="200">
      <header v="" e=""></header>
    </field>
    <field name="sl_01" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="sl_02" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="sl_03" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="ngay_01" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    <field name="ngay_02" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    <field name="ngay_03" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    
    <field name="nd_04" width="200">
      <header v="" e=""></header>
    </field>
    <field name="nd_05" width="200">
      <header v="" e=""></header>
    </field>
    <field name="nd_06" width="200">
      <header v="" e=""></header>
    </field>
    <field name="sl_04" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="sl_05" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="sl_06" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="ngay_04" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    <field name="ngay_05" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    <field name="ngay_06" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    
    <field name="nd_07" width="200">
      <header v="" e=""></header>
    </field>
    <field name="nd_08" width="200">
      <header v="" e=""></header>
    </field>
    <field name="nd_09" width="200">
      <header v="" e=""></header>
    </field>
    <field name="sl_07" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="sl_08" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="sl_09" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="ngay_07" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    <field name="ngay_08" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    <field name="ngay_09" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    
    <field name="nd_10" width="200">
      <header v="" e=""></header>
    </field>
    <field name="nd_11" width="200">
      <header v="" e=""></header>
    </field>
    <field name="nd_12" width="200">
      <header v="" e=""></header>
    </field>
    <field name="sl_10" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="sl_11" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="sl_12" type="Decimal" dataFormatString="@quantityInputFormat" clientDefault="0" width="80">
      <header v="" e=""></header>
    </field>
    <field name="ngay_10" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    <field name="ngay_11" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    <field name="ngay_12" type="DateTime" dataFormatString="@datetimeFormat" width="100" align="left">
      <header v="" e=""></header>
    </field>
    
    <field name="stt_rec" isPrimaryKey="true" readOnly="true" hidden="true" aliasName="a">
      <header v="" e=""></header>
    </field>
    <field name="stt_rec0" isPrimaryKey="true" width="0" hidden="true">
      <header v="" e=""></header>
    </field>
    <field name="line_nbr" type="Int32" width="0" align="right" hidden="true">
      <header v="" e=""></header>
    </field>
  </fields>

  <views>
    <view id="Grid">
      <field name="ma_nv"/>
      <field name="ten"/>
      <field name="stt_rec_nv"/>
      
      <field name="nd_01"/>
      <field name="nd_02"/>
      <field name="nd_03"/>
      <field name="sl_01"/>
      <field name="sl_02"/>
      <field name="sl_03"/>
      <field name="ngay_01"/>
      <field name="ngay_02"/>
      <field name="ngay_03"/>
      
      <field name="nd_04"/>
      <field name="nd_05"/>
      <field name="nd_06"/>
      <field name="sl_04"/>
      <field name="sl_05"/>
      <field name="sl_06"/>
      <field name="ngay_04"/>
      <field name="ngay_05"/>
      <field name="ngay_06"/>
      
      <field name="nd_07"/>
      <field name="nd_08"/>
      <field name="nd_09"/>
      <field name="sl_07"/>
      <field name="sl_08"/>
      <field name="sl_09"/>
      <field name="ngay_07"/>
      <field name="ngay_08"/>
      <field name="ngay_09"/>

      <field name="nd_10"/>
      <field name="nd_11"/>
      <field name="nd_12"/>
      <field name="ngay_10"/>
      <field name="ngay_11"/>
      <field name="ngay_12"/>
      <field name="sl_10"/>
      <field name="sl_11"/>
      <field name="sl_12"/>
      
      <field name="stt_rec"/>
      <field name="stt_rec0"/>
      <field name="line_nbr"/>
    </view>
  </views>

  <commands>
    <command event="Loading">
      <text>
        <![CDATA[select 'this._voucherCode='@@id';load$GridVoucherDetail$(this);' as message
return]]>
      </text>
    </command>
    <command event="Closing">
      <text>
        <![CDATA[select 'dispose$GridVoucherDetail$(this);' as message
return]]>
      </text>
    </command>
  </commands>

  <script>
    <text>
      <![CDATA[
function load$GridVoucherDetail$(a) {
	a.add_onResponseComplete(on$GridVoucherDetail$ResponseComplete);
	a.add_commandEvent(on$GridVoucherDetail$ExecuteCommand);
	a.$h = [
		["voucherCode", "String", a._voucherCode], "ma_dvcs"
	];
	udf$Detail$(a)
}

function dispose$GridVoucherDetail$(a) {
	a.$a = null;
	try {a.remove_commandEvent(on$GridVoucherDetail$ExecuteCommand)} catch (b) {}
	try {a.remove_onResponseComplete(on$GridVoucherDetail$ResponseComplete)} catch (b) {}
}

function on$GridVoucherDetail$ExecuteCommand(sender, e) {
	var action = e.type.Action, g = sender, f = g.get_element().parentForm;
	switch (action) {
    case 'AfterCloneRow':
      g.setItemFieldValue('stt_rec0', e.type.Value, '');
      break;
	}
}
function on$GridVoucherDetail$ResponseComplete(sender, e) {
	var g = e.object, context = e.type.Context, result = e.type.Result, o = e.type.Object, f = g.get_element().parentForm;
	switch (context) {
    case "EmployeeID":
			g.setItemGridBehavior(o, [
				["stt_rec_nv", result[0].Value, "", false],
				["ten", result[1].Value, "", false]
			]);
			break;
	}
}
function onchange$GridVoucherDetail$EmployeeID(o) {o.grid.request(o, "EmployeeID", "EmployeeID", ["ma_nv"])}
]]>
    </text>
  </script>

  <queries>
    <query event="Loading">
      <text>
        <![CDATA[
select @@fieldExternal from @@prime$partition$current a left join vhrnv b on a.stt_rec_nv = b.stt_rec where a.stt_rec = @stt_rec order by a.stt_rec, a.line_nbr
]]>
      </text>
    </query>
  </queries>

  <response>
    <action id="EmployeeID">
      <text>
        <![CDATA[
if exists(select 1 from hrnv where ma_nv = @ma_nv) begin
  select stt_rec as stt_rec_nv, ten from vhrnv where ma_nv = @ma_nv
  return
end
]]>
      </text>
    </action>
  </response>

  &XMLStandardDetailToolbar;

</grid>