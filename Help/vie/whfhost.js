var gsNoTopics="Không Tìm thấy Chủ đề.";var gsLoadXmlFailed="Lỗi: Không thể tải tệp xml.";var gsInitDatabaseFailed="Lỗi: Không thể khởi tạo cơ sở dữ liệu.";var gsNotAllDatabaseInited="Cảnh báo: Không phải tất cả cơ sở dữ liệu đều được tải. Một số chủ đề sẽ không được tìm thấy.";var gsInvalidExpression_1="Các từ bạn nhập không phải là cum từ hợp lệ.";var gsInvalidExpression_2="Nhấp";var gsInvalidExpression_3="Trợ giúp";var gsInvalidExpression_4="để tìm hiểu cách sử dụng cụ từ truy vấn (Để hoàn thành)";var gsSearching="Đang tìm kiếm...";var gsTitle="Tiêu đề";var gsRank="Xếp hạng";var gsCancel="Hủy";var gsCanceled="Huỷ";var gsSubstrSrch=0;var g_RunesVowels="\x61\x65\x69\x6F\x75\x79";var g_RunesWordBreaks="\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0E\x0F\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1A\x1B\x1C\x1D\x1E\x1F\x22\x5C\x20\x2E\x2C\x21\x40\x23\x24\x25\x5E\x26\x2A\x28\x29\x7E\x27\x60\x3A\x3B\x3C\x3E\x3F\x2F\x7B\x7D\x5B\x5D\x7C\x2B\x2D\x3D\xC2\x81\xC2\x82\xC2\x83\xC2\x84\xC2\x85\xC2\x86\xC2\x87\xC2\x88\xC2\x89\xC2\x8A\xC2\x8B\xC2\x8C\xC2\x8D\xC2\x8E\xC2\x8F\xC2\x90\xC2\x91\xC2\x92\xC2\x93\xC2\x94\xC2\x95\xC2\x96\xC2\x97\xC2\x98\xC2\x99\xC2\x9A\xC2\x9B\xC2\x9C\xC2\x9D\xC2\x9E\xC2\x9F\xC2\xA1\xC2\xA9\xC2\xAB\xC2\xAE\xC2\xB7\xC2\xBB\xC2\xBF\xC2\xA0";var g_RunesWhiteSpaces="\x20\x09\x0D\x0A\xC2\xA0";var g_RunesQuote="\x22";var g_RunesHelSuffixes=new Array("ed,0","ingly,0","ings,0","ing,0","ly,1","s,1","e,1");var gbHighLight=true;var gsHLColorFront="#000000";var gsHLColorBackground="#b2b4bf";var gsAscendFlag="&#9651;";var gsDescendFlag="&#9661;";var gAIRSearchObject;var gsResultDivID="ResultDiv";var gbReady=false;var gbXML=false;var gsBgColor="#ffffff";var gsBgImage="";var gsMargin="0pt";var gsIndent="0pt";var goFont=null;var goErrFont=null;var goHoverFont=null;var gsABgColor="#cccccc";var gbWhFHost=false;var gbAIRSearchResultDisplayDoneFn=dummySearchResultFn;var gbAIRSearchResultDoneSteps=0;var gbAIRSearchResultDone=false;var g_nSortType=0;var g_nX0=0;var g_nInitWidth=0;var g_bDraging=false;var g_nRankWidthMin=20;var ECS_NONE=0;var ECS_FTSREADY=1;var ECS_SEARCHING=2;var ECS_FATALERROR=3;var ECS_CANCELED=4;var ECS_SEARCHFAILED=5;var ECS_FOUND=6;var g_CurState=null;var g_CurPage=1;var g_nMaxPages=3;var g_sQuestion="";var g_bServerResult=false;gbSearchPage=true;var gbAIRSynonymString="";var gbAIRSearchString="";function setBackground(a){gsBgImage=a}function setBackgroundcolor(a){gsBgColor=a}function setFont(h,d,f,a,c,g,e){var b=new whFont(d,f,a,c,g,e);if(h=="Normal"){goFont=b}else{if(h=="Error"){goErrFont=b}else{if(h=="Hover"){goHoverFont=b}}}}function setActiveBgColor(a){gsABgColor=a}function setMargin(a){gsMargin=a}function setIndent(a){gsIndent=a}function window_OnLoad(){if(gsBgImage&&gsBgImage.length>0){document.body.background=gsBgImage}if(gsBgColor&&gsBgColor.length>0){document.body.bgColor=gsBgColor}writeResultDiv();if(gbAIR){return}if(gbAIRSSL){var c=_getPath(document.location.href);SeeForSearch(c);return}loadFts();var a=new whMessage(WH_MSG_SHOWFTS,this,1,null);SendMessage(a);a=new whMessage(WH_MSG_GETSEARCHSTR,this,1,null);var b="";if(SendMessage(a)){b=a.oParam;if(b!=" "){a=new whMessage(WH_MSG_SEARCHTHIS,this,1,b);SendMessage(a)}}}function writeResultDiv(){var a="<div id='"+gsResultDivID+"' style='position:absolute; width:100%'></div>";if(gbAIRSSL){document.body.innerHTML=a}else{document.body.insertAdjacentHTML("beforeEnd",a)}}function registListener(b,a){if(!gbAIRSSL){RegisterListener2(a,WH_MSG_SEARCHFTSKEY)}}function FtsWriteClassStyle(){var a="<STYLE TYPE='text/css'>\n";if(gsBgImage){a+="body {border-top:"+gsBgColor+" 1px solid;}\n"}else{if(gbAIR){a+="body {border-top:white 1px solid;}\n"}else{a+="body {border-top:black 1px solid;}\n"}}a+="P.msg {"+getFontStyle(goErrFont)+"margin-left:"+gsIndent+";margin-top:"+gsMargin+";}\n";a+="dl {"+getFontStyle(goFont)+"margin-left:"+gsIndent+";margin-top:"+gsMargin+";}\n";a+="A.fr_tc:link {"+getFontStyle(goFont)+"font-weight:bold;}\n";a+="A.fr_tc:visited {"+getFontStyle(goFont)+"font-weight:bold;}\n";a+="A.fr_tc:hover {"+getFontStyle(goHoverFont)+"font-weight:bold;}\n";a+="A.fr_act {background-color:"+gsABgColor+";}\n";a+="A.fr_act:link {"+getFontStyle(goFont)+"}\n";a+="A.fr_act:visited {"+getFontStyle(goFont)+"}\n";a+="A.fr_act:hover {"+getFontStyle(goHoverFont)+"}\n";a+="LI.sl_page{display:block;display:inline-block;float:left;cursor:pointer;text-decoration:none;border:1px solid #ccc;padding:.3em .7em;margin:0 .38em 0 0;text-align:center}\n";a+="LI.sl_pageC{background:#f0f7e8;border:1px solid #83bc46;display:block;display:inline-block;float:left;cursor:pointer;text-decoration:none;padding:.3em .7em;margin:0 .38em 0 0;text-align:center}\n";a+="LI.sl_pageN{cursor:pointer;padding:.2em .5em;margin:0 .38em 0 0;border:none;text-decoration:underline}\n";a+="TD.fr_tt, TD.fr_tc, TD.fr_ts {"+getFontStyle(goFont)+"height:auto;}\n";if(gbAIRSSL){a+="TD.fr_ts {padding:0.2em 0em;border-style:solid solid solid none;border-color:"+gsABgColor+";border-width:1px;}\n"}else{a+="TD.fr_ts {padding:0.2em 0em;border-style:none solid solid none;border-color:"+gsABgColor+";border-width:1px;}\n"}if(gbAIRSSL){a+="TD.fr_tt {padding:0.2em 0.5em;border-style:solid none solid none;border-color:"+gsABgColor+";border-width:1px;}\n"}else{a+="TD.fr_tt {padding:0.2em 0.5em;border-style:none none solid none;border-color:"+gsABgColor+";border-width:1px;}\n"}a+="TD.fr_tc {padding:0.2em 0.5em;}\n";a+="P.pb_tt {"+getFontStyle(goErrFont)+"padding:0;margin:3px;}\n";a+="P.pb_in {"+getFontStyle(goErrFont)+"position:relative;padding:0;margin:0;left:0%;top:0%;height:10px;border-style:none;background-color:blue;}\n";a+="DIV.pb_out {width:100%;border-style:solid;border-width:1px;padding:0;margin:0;background-color:"+gsABgColor+";}\n";a+="P.pb_cancel {"+getFontStyle(goHoverFont)+"cursor:pointer;padding:0;margin:3px}\n";a+="</STYLE>";document.write(a)}function window_Unload(){if(!gbAIRSSL){UnRegisterListener2(this,WH_MSG_PROJECTREADY);UnRegisterListener2(this,WH_MSG_SEARCHFTSKEY)}}function mrFindFTSKey(){if(goOdinHunter.aProjPathes.length<=0){return}var a=goOdinHunter.aProjPathes[0].strOdbPath+"&question="+escape(g_sQuestion)+"&log=1";g_bServerResult=true;loadDataXML(a,false)}function onSendMessage(a){if(gbAIRSSL){return true}var b=a.nMessageId;if(b==WH_MSG_SEARCHFTSKEY){if(a.oParam){if(mrIsOnEngine()==true){g_sQuestion=a.oParam;mrFindFTSKey()}else{goOdinHunter.strQuery=a.oParam;setTimeout("Query()",1)}}}else{if(b==WH_MSG_PROJECTREADY){loadFts()}}return true}var context=new HuginContext();var goOdinHunter=null;var theXmlReader=new XmlReader();function XmlNode(){this.strTagName=null;this.aAttrs=new Array()}function XmlData(){this.strFilePath=null;this.strRoot=null;this.aNodes=new Array()}function XmlReader(){this.strFilePath=null;this.funcCallback=null;this.bSucceed=false;this.xmlDoc=null;this.aCache=new Array();this.bCache=false;this.curData=null;this.loadFromCache=function(){for(var i=0;i<this.aCache.length;i++){if(this.aCache[i].strFilePath==this.strFilePath){this.curData=this.aCache[i];return true}}return false};this.loadFromFile=function(a_funcCallback,a_bCache){this.funcCallback=a_funcCallback;this.bCache=(a_bCache==true)?true:false;if(this.loadFromCache()){this.funcCallback();return}loadDataXML(this.strFilePath,false)};this.receiveDom=function(a_XmlDoc){this.curData=null;if(a_XmlDoc.documentElement==null){return}this.curData=new XmlData();this.curData.strFilePath=this.strFilePath;with(a_XmlDoc.documentElement){this.curData.strRoot=tagName;for(var i=0;i<childNodes.length;i++){with(a_XmlDoc.documentElement.childNodes.item(i)){if(nodeType==3){continue}var nLen=this.curData.aNodes.length;this.curData.aNodes[nLen]=new XmlNode();this.curData.aNodes[nLen].strTagName=tagName;for(var j=0;j<attributes.length;j++){this.curData.aNodes[nLen].aAttrs[attributes.item(j).name]=attributes.item(j).value}}}}if(this.bCache){this.aCache[this.aCache.length]=this.curData}};this.getNumOfNodes=function(){return this.curData.aNodes.length};this.getNumOfTopics=function(i){with(this.curData){if(i<aNodes.length){var num;try{num=parseInt(aNodes[i].aAttrs.num)}catch(e){return 0}return num}else{return 0}}};this.checkRoot=function(a_strRootName){return this.curData.strRoot==a_strRootName};this.getSynonyms=function(a_strQuery){if(gsSubstrSrch){var synonyms="";with(this.curData){for(var i=0;i<aNodes.length;i++){if(aNodes[i].aAttrs.nm.indexOf(a_strQuery)!=-1){synonyms+=","+aNodes[i].aAttrs.sy}}}return synonyms}else{return this.getAttr("wd","nm",a_strQuery,"sy")}};this.getWordRec=function(a_strQuery,bPhraseSearch){var begin=0;var end=this.curData.aNodes.length;var mid=Math.floor((end-begin)/2);while(mid>0){mid=mid+begin;var term=this.curData.aNodes[mid].aAttrs.nm;if(a_strQuery<term){end=mid}else{if(a_strQuery>term){begin=mid}else{break}}mid=Math.floor((end-begin)/2)}if(((end-begin)==1)&&(!this.matchPrefix(a_strQuery,this.curData.aNodes[mid].aAttrs.nm))){mid=end}if(mid<this.curData.aNodes.length){if(!bPhraseSearch&&gsSubstrSrch){var arrTopicRecs=new Array();while(mid<this.curData.aNodes.length){if(this.curData.aNodes[mid].aAttrs.sp){mid++;continue}else{if(this.matchPrefix(a_strQuery,this.curData.aNodes[mid].aAttrs.nm)){arrTopicRecs[arrTopicRecs.length]=this.curData.aNodes[mid].aAttrs.rd;mid++}else{break}}}if(arrTopicRecs.length==0){return""}var mergedRec=arrTopicRecs[0];for(var i=1;i<arrTopicRecs.length;i++){mergedRec=mergeTopicRec(mergedRec,arrTopicRecs[i])}return mergedRec}else{if((this.curData.aNodes[mid].aAttrs.nm)==a_strQuery){if(bPhraseSearch||gsSubstrSrch){return this.curData.aNodes[mid].aAttrs.rd}else{if(this.curData.aNodes[mid].aAttrs.sp){return""}else{return this.curData.aNodes[mid].aAttrs.rd}}}else{return""}}}};this.getTopicRec=function(a_nTopicId){if((a_nTopicId>=0)&&(a_nTopicId<this.curData.aNodes.length)){var objResult=new Object();objResult.rd=this.curData.aNodes[a_nTopicId].aAttrs.rd;objResult.ct=this.curData.aNodes[a_nTopicId].aAttrs.ct;return objResult}else{return null}};this.getPackageIndex=function(a_strQuery){var begin=0;var end=this.curData.aNodes.length-1;var mid;while(begin<=end){mid=Math.floor((begin+end)/2);var startWord=this.curData.aNodes[mid].aAttrs.fm;var endWord=this.curData.aNodes[mid].aAttrs.to;if(end==begin){if((a_strQuery>=startWord)&&(a_strQuery<=endWord)){return mid}else{return -1}}if(a_strQuery<startWord){end=mid-1}else{if(a_strQuery>endWord){begin=mid+1}else{return mid}}}return -1};this.matchPrefix=function(a_strQuery,a_strTerm){if(a_strQuery.length>a_strTerm.length){return false}var bPrefix=true;var i;for(i=0;i<a_strQuery.length;i++){if(a_strQuery.charAt(i)!=a_strTerm.charAt(i)){bPrefix=false;break}}return bPrefix};this.getAttr=function(a_strTagName){var nArgsNum=this.getAttr.arguments.length;if(nArgsNum<2||nArgsNum%2!=0){return""}with(this.curData){for(var i=0;i<aNodes.length;i++){if(utf8Compare(aNodes[i].strTagName,a_strTagName)!=0){continue}for(var j=1;j+1<nArgsNum-1;j+=2){if(utf8Compare(aNodes[i].aAttrs[this.getAttr.arguments[j]],this.getAttr.arguments[j+1])!=0){break}}if(j+1<nArgsNum-1){continue}if(aNodes[i].aAttrs[this.getAttr.arguments[j]]){return aNodes[i].aAttrs[this.getAttr.arguments[j]]}else{continue}}return""}};this.checkAttr=function(a_strTagName){var nArgsNum=this.checkAttr.arguments.length;if(nArgsNum<1||nArgsNum%2==0){return false}with(this.curData){for(var i=0;i<aNodes.length;i++){if(utf8Compare(aNodes[i].strTagName,a_strTagName)!=0){continue}for(var j=1;j<nArgsNum-1;j+=2){if(utf8Compare(aNodes[i].aAttrs[this.checkAttr.arguments[j]],this.checkAttr.arguments[j+1])!=0){break}}if(j<nArgsNum-1){continue}return true}return false}}}function putDataXML(f,e){if(g_bServerResult==true){g_bServerResult=false;var g=f.lastChild;var d=new HuginQueryResult();var b=1;if(g){var c=g.firstChild;while(c){if(c.nodeName=="topic"){var a=new Object();a.nIndex=b;a.strTitle=c.getAttribute("name");a.strUrl=c.getAttribute("url");a.strSummary=c.getAttribute("summary");a.nRank=c.getAttribute("rank");d.aTopics[d.aTopics.length]=a}c=c.nextSibling;b=b+1}}displayTopics(d)}else{theXmlReader.receiveDom(f);theXmlReader.bSucc=true;theXmlReader.funcCallback()}}function mergeTopicRec(k,h){var b=k.split("|");var c=h.split("|");var n="";var e=0;var d=0;var f=new Array();while(e<b.length&&d<c.length){var m=getTopicDetails(b[e]);if(m==null){e++;continue}var a=getTopicDetails(c[d]);if(a==null){d++;continue}if(m.nTopicId<a.nTopicId){f[f.length]=b[e];e++}else{if(m.nTopicId>a.nTopicId){f[f.length]=c[d];d++}else{var l=b[e].split(":");var o=(m.uEmphasis>a.uEmphasis)?m.uEmphasis:a.uEmphasis;var g=m.nTopicId+","+o+":"+l[1];f[f.length]=g;d++;e++}}}while(e<b.length){f[f.length]=b[e];e++}while(d<c.length){f[f.length]=c[d];d++}if(f.length==0){return k}n=f[0];for(e=1;e<f.length;e++){n+="|"+f[e]}return n}function getTopicDetails(d){var b=d.indexOf(",");if(b==-1){return null}var c=d.substring(0,b);var e=d.substring(b+1,d.length);var f=e.split(":");if(f.length==0){return null}var a=new Object();a.nTopicId=c;a.uEmphasis=parseInt(f[0]);return a}function onLoadXMLError(){if(window.gbTesting){return}theXmlReader.bSucc=false;theXmlReader.funcCallback()}function splitPathName(c){var a=new Object();a.strDir="";a.strFile="";a.strExt="";var e=/^(.*[\\\/])?([^\\\/]+)(\.[^\\\/\.]*)$/;var d=/^(.*[\\\/])?([^\\\/.]+)$/;var b=c.match(e);if(b!=null){a.strDir=b[1];a.strFile=b[2];a.strExt=b[3]}else{b=c.match(d);a.strDir=b[1];a.strFile=b[2];a.strExt=""}return a}function getAbsPath(a,c){var b=splitPathName(a);return b.strDir+c}function HuginContext(){this.aTasks=new Array();this.bExecuting=false;this.bCallBack=false;this.bCallBackReady=false;this.nLastTime=0;this.bError=false;this.bCancel=false;this.strMsg=null;this.reset=function(){this.aTasks.length=0;this.bExecuting=false;this.bCallBack=false;this.bCallBackReady=false;this.nLastTime=0;this.bError=false;this.bCancel=false;this.strMsg=null};this.push=function(){var a=0;var b=new Array();while(a<context.push.arguments.length){var c=b.length;b[c]=new Object();b[c].func=context.push.arguments[a];b[c].owner=context.push.arguments[a+1];a+=2;var d=false;if(a<context.push.arguments.length&&context.push.arguments[a].constructor.toString().search(/^\nfunction Boolean/)==0){var d=context.push.arguments[a];++a}b[c].bSuspend=d}for(a=b.length-1;a>=0;--a){context.aTasks[context.aTasks.length]=b[a]}};this.pop=function(){if(context.aTasks.length==0){return null}var a=context.aTasks[context.aTasks.length-1];context.aTasks.length--;return a};this.initTime=function(){context.nLastTime=(new Date()).getTime()};this.needBreathe=function(){var a=(new Date()).getTime();return a-context.nLastTime>=100};this.resume=function(){if(context.bExecuting){if(context.bCallBack){context.bCallBackReady=true}return}context.bExecuting=true;context.initTime();while(true){if(context.bCancel){context.bExecuting=false;g_CurState=ECS_CANCELED;updateResultView();return true}var a=context.pop();if(a==null){context.bExecuting=false;return true}context.bCallBack=a.bSuspend;a.func(context,a.owner,context.resume);if(context.bError){context.bExecuting=false;g_CurState=ECS_FATALERROR;updateResultView();return}if(context.bCallBack&&!context.bCallBackReady){context.bExecuting=false;return}context.bCallBack=false;context.bCallBackReady=false;if(context.needBreathe()){context.bExecuting=false;updateResultView();if(gbAIR){context.resume()}else{setTimeout("context.resume();",1)}return}}};this.stop=function(){context.bCancel=true}}var XX=127;var s_strBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var s_aAsciiToBase64=new Array(XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,XX,62,XX,XX,XX,63,52,53,54,55,56,57,58,59,60,61,XX,XX,XX,XX,XX,XX,XX,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,XX,XX,XX,XX,XX,XX,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,XX,XX,XX,XX,XX);var s_aOdinToAscii=new Array("\0","0","1","2","3","4","5","6","7","8","9","|",":",",","\0","\0");var s_aBase64DecodeMap=new Array();function _decordBase64ToStr(b,f){var a=(s_aAsciiToBase64[b]<<6)+s_aAsciiToBase64[f];var c="";var e=0;for(var d=0;d<=8;d+=4){e=a>>(8-d)&15;if(e==0){return c}c+=s_aOdinToAscii[e]}return c}function decodeBase64ToOdin(c){var d=c.length;var a="";var e=0;for(var b=0;b+1<d;b+=2){e=s_aBase64DecodeMap[(c.charCodeAt(b)<<8)+c.charCodeAt(b+1)];if(!e){return a}a+=e}if(b<d){e=s_aBase64DecodeMap[(c.charCodeAt(b)<<8)+s_strBase64.charCodeAt(0)];if(!e){return a}a+=e}return a}function initBase64DecodeMap(){var b,a;for(b=0;b<64;b++){for(a=0;a<64;a++){s_aBase64DecodeMap[(s_strBase64.charCodeAt(b)<<8)+s_strBase64.charCodeAt(a)]=_decordBase64ToStr(s_strBase64.charCodeAt(b),s_strBase64.charCodeAt(a))}}for(b=0;b<64;b++){s_aBase64DecodeMap[s_strBase64.charCodeAt(b)<<8]=_decordBase64ToStr(s_strBase64.charCodeAt(b),s_strBase64.charCodeAt(0))}}initBase64DecodeMap();function HuginStemRecordTopicShape(){this.aPositions=null}function HuginStemRecordTopic(){this.uEmphasis=null;this.aShapes=null}function HuginStemRecord(){this.aTopics=null}function HuginPackageReaderResult(){this.strNefStem=null;this.strRecord=null;this.bStopWord=null}function HuginPackageReader(){this.strPackagePath=null;this.strSynonymPath=null;this.recordResult=null;this.strQueryWord=null;this.bPhraseSearch=false;this.bSucc=true;this.prepareQuery=function(){this.recordResult=null;this.bSucc=true;this.strQueryWord=null;this.bPhraseSearch=false};this.loadFromFile=function(c,a,b){theXmlReader.loadFromFile(b,false)};this.pickSynonyms=function(a){return theXmlReader.getSynonyms(a).split(",")};this.setSynonymForHighlighting=function(f,a){if(!theXmlReader.bSucc){return}var e="";var d=a.pickSynonyms(a.strQueryWord);for(var b=0;b<d.length;++b){e+=" "+d[b]}if((e=="")||(e==" ")){return}if(!gbAIRSSL){var c=new whMessage(WH_MSG_SETSYNSTR,a,1,e);SendMessage(c)}else{gbAIRSynonymString=e}};this.doQueryWordRecord=function(c,b){if(!theXmlReader.bSucc){c.strMsg=gsLoadXmlFailed;c.bError=true;return}if(!b.bSucc){return}b.recordResult=new HuginPackageReaderResult();var a=theXmlReader.getWordRec(b.strQueryWord,b.bPhraseSearch);if(a==null){return}b.recordResult.bStopWord=false;b.recordResult.strNefStem=b.strQueryWord;b.recordResult.strRecord=a;if(a==""){b.bSucc=false;return}b.bSucc=true;theXmlReader.strFilePath=b.strSynonymPath;c.push(b.loadFromFile,b,b.setSynonymForHighlighting,b)};this.query=function(b,a){a.bSucc=true;theXmlReader.strFilePath=a.strPackagePath;b.push(a.loadFromFile,a,a.doQueryWordRecord,a)}}function HuginPackageIndexReader(){this.queryWord=null;this.strPackageIndexPath=null;this.packageInfo=null;this.bSucc=true;this.strCurQuery=null;this.strPackageInfo=null;this.prepareQuery=function(){this.packageInfo=null;this.bSucc=true;this.strCurQuery=null;this.strPackageInfo=null};this.getPackagePath=function(a){var b=splitPathName(this.strPackageIndexPath);return b.strDir+"package_"+a+b.strExt};this.getTopicTablePath=function(a){var b=splitPathName(this.strPackageIndexPath);return b.strDir+"topictable_"+a+b.strExt};this.parsePackageInfo=function(c,b){if(!theXmlReader.bSucc||!theXmlReader.checkRoot("cki")){b.bSucc=false;return}var a=theXmlReader.getPackageIndex(b.strCurQuery);if(a==null||a<0){b.packageInfo=null;b.bSucc=false;return}b.packageInfo=b.getPackagePath(a);this.bSucc=true;return};this.parseTopicInfo=function(c,b){if(!theXmlReader.bSucc||!theXmlReader.checkRoot("cki")){b.bSucc=false;return}var a=theXmlReader.getPackageIndex(b.strCurQuery);if(a==null||a<0){b.packageInfo=null;b.bSucc=false;return}b.packageInfo=b.getTopicTablePath(a);this.bSucc=true;return};this.loadFromFile=function(c,a,b){theXmlReader.loadFromFile(b,false)};this.queryPackageInfo=function(b,a){a.bSucc=true;theXmlReader.strFilePath=a.strPackageIndexPath;b.push(a.loadFromFile,a,a.parsePackageInfo,a)};this.queryTopicInfo=function(b,a){a.bSucc=true;theXmlReader.strFilePath=a.strPackageIndexPath;b.push(a.loadFromFile,a,a.parseTopicInfo,a)}}function HuginTopicTableReader(){this.nQueryId=null;this.strTopicTablePath=null;this.lastIndex=-1;this.topicInfo=null;this.bSucc=true;this.strTopicInfo=null;this.strTopicContext=null;this.topicMap=null;this.curTopicIndex=null;this.prepareQuery=function(){this.bSucc=true;this.strTopicInfo=null};this.loadFromFile=function(c,a,b){theXmlReader.loadFromFile(b)};this.processReaderResult=function(c,a){if(!theXmlReader.bSucc||!theXmlReader.checkRoot("ck")){a.bSucc=false;a.bInited=false;return}var b=a.nQueryId;if(a.curTopicIndex>0){b=b-a.topicMap[a.curTopicIndex-1]}var d=theXmlReader.getTopicRec(b);a.strTopicInfo=d.rd;a.strTopicContext=d.ct};this.parseTopicInfo=function(c,b){if(!b.bSucc){return}b.topicInfo=new Object();var a=b.strTopicInfo.split("|");if(a.length<2||a[0]==""||a[1]==""){b.bSucc==false;return}b.topicInfo.strUrl=a[0];b.topicInfo.strTitle=a[1]};this.queryTopicInfo=function(d,b){for(var c=0;c<b.topicMap.length;c++){if(b.nQueryId<b.topicMap[c]){break}}if(c>=b.topicMap.length){b.bSucc==false;return}b.curTopicIndex=c;var a="topictable_"+c+".xml";if(c!=b.lastIndex){b.lastIndex=c;theXmlReader.strFilePath=getAbsPath(b.strTopicTablePath,a);d.push(b.loadFromFile,b,b.processReaderResult,b,b.parseTopicInfo,b)}else{d.push(b.processReaderResult,b,b.parseTopicInfo,b)}};this.makeIndexMap=function(d,a){a.topicMap=new Array();var c=0;for(var b=0;b<theXmlReader.getNumOfNodes();b++){a.topicMap[b]=theXmlReader.getNumOfTopics(b)+c;c=a.topicMap[b]}};this.prepareMap=function(b,a){a.bSucc=true;theXmlReader.strFilePath=a.strTopicTablePath;b.push(a.loadFromFile,a,a.makeIndexMap,a)}}function HuginDatabase(){this.strOdbPath="";this.queryWord=null;this.bNeedStopWord=false;this.recordResult=null;this.eType=null;this.aQueryTopics=null;this.bSucc=false;this.bInited=false;this.strTopicTablePath=null;this.strPackageIndexPath=null;this.strSynonymPath=null;this.packageInfo=null;this.iCurTopic=null;this.packageIndexReader=new HuginPackageIndexReader();this.packageReader=new HuginPackageReader();this.topicReader=new HuginTopicTableReader();this.prepareQuery=function(){this.recordResult=null;this.bSucc=true;this.packageInfo=null;this.iCurTopic=0;this.packageIndexReader.prepareQuery();this.packageReader.prepareQuery();this.topicReader.prepareQuery();this.eType=ESNT_DEFAULT};this.getIndexUrl=function(a){var b=theXmlReader.getAttr("index","type",a,"url");if(b==""){return""}return getAbsPath(this.strOdbPath,b)};this.readOdbInfo=function(b,a){if(!theXmlReader.bSucc||!theXmlReader.checkRoot("odb")){a.bSucc=false;a.bInited=false;return}a.strTopicTablePath=a.getIndexUrl("TopicIndex");a.strPackageIndexPath=a.getIndexUrl("PackageIndex");a.strSynonymPath=a.getIndexUrl("Synonym");if(a.strTopicTablePath==""||a.strPackageIndexPath==""||a.strSynonymPath==""){a.bSucc=false;a.bInited=false;return}else{a.bSucc=true;a.bInited=true}};this.loadFromFile=function(c,a,b){theXmlReader.loadFromFile(b)};this.queryRecordInPackage=function(b,a){if(!a.packageIndexReader.bSucc){return}a.packageInfo=a.packageIndexReader.packageInfo;a.packageReader.strPackagePath=a.packageInfo;a.packageReader.strSynonymPath=a.strSynonymPath;a.packageReader.bPhraseSearch=(a.eType==ESNT_PHRASE);if(gsSubstrSrch){a.packageReader.strQueryWord=a.queryWord.strNormalizedOrg}else{a.packageReader.strQueryWord=a.queryWord.strHelStem}b.push(a.packageReader.query,a.packageReader)};this.makeResult=function(b,a){if(!a.packageIndexReader.bSucc||!a.packageReader.bSucc){a.bSucc=false}a.recordResult=a.packageReader.recordResult;if(a.eType==ESNT_NOT){if((typeof(a.recordResult)=="undefined")||(a.recordResult==null)){a.bSucc=true;a.recordResult=a.makeDummyResultRec(a.queryWord.strNormalizedOrg,a.queryWord.strHelStem)}theXmlReader.strFilePath=a.strTopicTablePath;b.push(a.loadFromFile,a,a.makeNotResult,a)}};this.makeDummyResultRec=function(c,a){var b=new Object();b.strRecord="";b.strNefStem=a;b.bStopWord=false;return b};this.makeNotResult=function(n,f){var p=f.recordResult.strRecord.split("|");var m=(f.recordResult.strRecord=="");var l=new Array();var g;for(g=0;g<p.length;g++){var o=p[g].indexOf(",");if(o!=-1){l[l.length]=p[g].substring(0,o)}}var r=false;if(l.length>0){r=true}var b=0;var d=",192:0,0,10";var h=0;var q=0;for(var e=0;e<theXmlReader.getNumOfNodes();e++){q+=theXmlReader.getNumOfTopics(e)}f.recordResult.strRecord="";while(h<q){var a=true;if(r&&(b<l.length)&&(l[b]==h)&&(!m)){b++;a=false}if(a){f.bSucc=true;var c=h+d;if(f.recordResult.strRecord==""){f.recordResult.strRecord=c}else{f.recordResult.strRecord+="|"+c}}h++}};this.init=function(b,a){theXmlReader.strFilePath=a.strOdbPath;b.push(a.loadFromFile,a,a.readOdbInfo,a)};this.queryRecord=function(b,a){if(!a.bInited){a.bSucc=false;return}a.bSucc=true;a.packageIndexReader.strPackageIndexPath=a.strPackageIndexPath;if(gsSubstrSrch){a.packageIndexReader.strCurQuery=a.queryWord.strNormalizedOrg}else{a.packageIndexReader.strCurQuery=a.queryWord.strHelStem}b.push(a.packageIndexReader.queryPackageInfo,a.packageIndexReader,a.queryRecordInPackage,a,a.makeResult,a)};this.processTopicInfo=function(b,a){if(!a.topicReader.bSucc){a.bSucc=false;return}a.aQueryTopics[a.iCurTopic].strUrl=a.topicReader.topicInfo.strUrl;a.aQueryTopics[a.iCurTopic].strTitle=a.topicReader.topicInfo.strTitle;a.aQueryTopics[a.iCurTopic].strSummary=a.topicReader.strTopicContext};this.incCurTopic=function(b,a){a.iCurTopic++};this.queryTopicInfo=function(b,a){if(a.iCurTopic>=a.aQueryTopics.length){return}a.topicReader.nQueryId=a.aQueryTopics[a.iCurTopic].nTopicId;b.push(a.topicReader.queryTopicInfo,a.topicReader,a.processTopicInfo,a,a.incCurTopic,a,a.queryTopicInfo,a)};this.queryTopicInfos=function(b,a){if(!a.bInited){a.bSucc=false;return}a.bSucc=true;a.topicReader.strTopicTablePath=a.strTopicTablePath;a.iCurTopic=0;a.topicReader.lastIndex=-1;b.push(a.topicReader.prepareMap,a.topicReader,a.queryTopicInfo,a)}}function LanguageService(){this.getNormalizedOrg=function(c,a){var d=c.toUpperCase();var b=c.toLowerCase();if(utf8Compare(d,b)==0||utf8Compare(d,c)!=0){a.strNormalizedOrg=b;a.bUpperCase=false}else{a.strNormalizedOrg=d;a.bUpperCase=true}};this.stemWith=function(b,c){var h=c.split(",");var f=h[0];var a=(h[1]=="1");var j=b.match("^..+"+f+"$");if(j==null){return null}var e=b.length-f.length;var d=false;if(!a){if(!this.isVowel(b.charAt(e-1))){if(b.charAt(e-1)==b.charAt(e-2)){e--}else{d=true}}}var g=b.substr(0,e);if(g.length<=2){return null}return g};this.helStem=function(b){var f=b.strNormalizedOrg.toLowerCase();var e=g_RunesHelSuffixes.length;var d=0;var a=null;for(var c=0;c<e;c++){a=this.stemWith(f,g_RunesHelSuffixes[c]);if(a!=null){d=c+1;break}}if(a==null){a=f}b.strHelStem=a;b.nHelWordShape=b.bUpperCase?d*2+1:d*2};this.isVowel=function(a){return g_RunesVowels.indexOf(a)>=0};this.isWordBreak=function(a){return(!this.isQuote(a)&&g_RunesWordBreaks.indexOf(a)>=0)};this.isWhiteSpace=function(a){return(g_RunesWhiteSpaces.indexOf(a)>=0)};this.isQuote=function(a){return(a==g_RunesQuote)};this.isAND=function(a){return(a=="and")};this.isOR=function(a){return(a=="or")};this.isNOT=function(a){return(a=="not")};this.isOperator=function(a){if(a=="and"||a=="or"||a=="not"){return true}}}var ESNT_AND=1;var ESNT_OR=2;var ESNT_NOT=3;var ESNT_DEFAULT=4;var ESNT_PHRASE=5;function RunesContext(a){this.strSrc=a;this.nCur=0;this.bFailed=false;this.bNot=false;this.nWordIndex=0;this.getCurChar=function(){return this.strSrc.charAt(this.nCur)};this.getChar=function(b){return this.strSrc.charAt(b)};this.reachEnd=function(){return this.nCur>=this.strSrc.length}}function DolWord(b,a){this.strWord=b;this.nPosition=a}function SolNode(){}function RunesService(){this.langSev=new LanguageService();this.isOperator=function(c,a){var b=this.getWord(c,a).toLowerCase();if(this.langSev.isOperator(b)){return true}return false};this.getLengthOfWordBreak=function(d,a){var b=a,c=d.length;while(b<c&&this.langSev.isWordBreak(d.charAt(b))){b++}return b-a};this.getLengthOfWord=function(d,a){var b=a,c=d.length;while(b<c&&!this.langSev.isWordBreak(d.charAt(b))&&!this.langSev.isQuote(d.charAt(b))){++b}return b-a};this.getWord=function(c,a){var b=this.getLengthOfWord(c,a);return c.substr(a,b)};this.getPositionInc=function(e,a){var c=a,d=e.length,b=1;while(c<d&&this.langSev.isWordBreak(e.charAt(c))){if(!this.langSev.isWhiteSpace(e.charAt(c))){b++}c++}return b};this.getTerm=function(c,a){if(this.langSev.isQuote(c.getCurChar())){c.nCur++;var b=this.getLengthOfPhrase(c.strSrc,c.nCur);if(b<=0){return false}a.eType=ESNT_PHRASE;a.strTerm=c.strSrc.substr(c.nCur,b);c.nCur+=b+1}else{var b=this.getLengthOfDefault(c.strSrc,c.nCur);if(b<=0){return false}a.eType=ESNT_DEFAULT;a.strTerm=c.strSrc.substr(c.nCur,b);c.nCur+=b}return true};this.getOperator=function(c,a){if(c.reachEnd()){return false}var b=this.getWord(c.strSrc,c.nCur).toLowerCase();if(this.langSev.isAND(b)){a.eType=ESNT_AND;c.nCur+=b.length}else{if(this.langSev.isOR(b)){a.eType=ESNT_OR;c.nCur+=b.length}else{if(this.langSev.isNOT(b)){a.eType=ESNT_NOT;c.nCur+=b.length}else{a.eType=ESNT_OR}}}return true};this.getLengthOfPhrase=function(d,a){var b=a,c=d.length;while(b<c){if(this.langSev.isQuote(d.charAt(b))){return b-a}++b}return -1};this.getLengthOfDefault=function(d,a){var b=a,c=d.length;while(b<c&&!this.isOperator(d,b)&&!this.langSev.isQuote(d.charAt(b))){b+=this.getLengthOfWord(d,b);b+=this.getLengthOfWordBreak(d,b)}return b-a};this.parseOperator=function(d,a,c){d.nCur+=this.getLengthOfWordBreak(d.strSrc,d.nCur);var b=new Object;if(!this.getOperator(d,b)){return false}if(b.eType==ESNT_NOT){if(c){if(d.bNOT){b.eType=ESNT_OR}else{d.bNOT=true}}else{d.bFailed=true;return false}}a.eType=b.eType;a.right=new SolNode();if(!this.parseTerm(d,a.right)){return false}return true};this.parseTerm=function(c,a){c.nCur+=this.getLengthOfWordBreak(c.strSrc,c.nCur);var b=new Object;if(!this.getTerm(c,b)){if((this.parseOperator(c,b,true))&&(b.eType==ESNT_NOT)){a.eType=b.eType;if(b.right.eType==ESNT_DEFAULT){a.strTerm=b.right.strTerm;return true}else{c.bFailed=true;return false}}else{c.bFailed=true;return false}}if(this.parseOperator(c,a,false)){a.left=new SolNode();a.left.eType=b.eType;a.left.strTerm=b.strTerm}else{a.eType=b.eType;a.strTerm=b.strTerm}return true};this.extractTerm=function(c,a){a.aWords=new Array();this.dolSegment(a.strTerm,a.aWords);if(a.aWords.length==0){return false}for(var b=0;b<a.aWords.length;b++){a.aWords[b].nWordId=a.aWords[b].nPosition+c.nWordIndex}c.nWordIndex=a.aWords[a.aWords.length-1].nWordId+1;return true};this.parsePhraseAndDefault=function(b,a){if(a.eType==ESNT_PHRASE||a.eType==ESNT_DEFAULT||a.eType==ESNT_NOT){if(!this.extractTerm(b,a)&&a.eType==ESNT_PHRASE){b.bFailed=true}}else{this.parsePhraseAndDefault(b,a.left);this.parsePhraseAndDefault(b,a.right)}};this.helStem=function(b,a){this.langSev.getNormalizedOrg(b,a);this.langSev.helStem(a)};this.dolSegment=function(d,a){var e=d.length;var c=0;var b=1;var f="";c+=this.getLengthOfWordBreak(d,c);while(c<e){f=this.getWord(d,c);a[a.length]=new DolWord(f,b);c+=f.length;b+=this.getPositionInc(d,c);c+=this.getLengthOfWordBreak(d,c)}};this.solParse=function(c,a){var b=new RunesContext(c);this.parseTerm(b,a);if(b.bFailed){return false}this.parsePhraseAndDefault(b,a);if(b.bFailed){return false}return true}}function _helStemNode(a_Runes,a_Node){with(a_Node){if(eType==ESNT_PHRASE||eType==ESNT_DEFAULT||eType==ESNT_NOT){for(var i=0;i<aWords.length;i++){a_Runes.helStem(aWords[i].strWord,aWords[i])}}else{_helStemNode(a_Runes,left);_helStemNode(a_Runes,right)}}}function parseQueryExpression(b){var a=new RunesService();var c=new SolNode();if(!a.solParse(b,c)){return null}_helStemNode(a,c);return c}var EWMT_NotMatch=0;var EWMT_SynonymMatch=1;var EWMT_WordMatch=2;var EWMT_ShapeMatch=3;var WEIGHT_OF_SHAPE_MATCH=0.5;var WEIGHT_OF_SINGLE_WORD_SCORE=0.5;var HUGIN_KEYWORD_FLAG=64;var HUGIN_TITLE_FLAG=128;var WORDSHAPE_SYNONYM=-2;function _rank_ULaw(a){if(a<0){return 0}return 1-1/(a+1)}function _rank_Weaken(b,a){var c=(a<0)?0:(a>1)?1:a;return 1-c+b*c}function _isKeyWord(a){return(a&HUGIN_KEYWORD_FLAG)!=0}function _isTitle(a){return(a&HUGIN_TITLE_FLAG)!=0}function _isUpperCaseShape(a){return a%2!=0}function _emphasisToScore(d){var c=0;for(var b=5,a=2;b>=0;b--,a*=2){c+=a*((d>>b)&1)}return c}function _getWordMatchType(d,b,c,e){var g=EWMT_NotMatch;if(c-e!=d.nWordId){return g}for(var a=0;a<b.aWords.length;a++){var f=EWMT_NotMatch;if(b.aWords[a].nWordId==d.nWordId){if(b.aWords[a].nWordForm==WORDSHAPE_SYNONYM){f=EWMT_SynonymMatch}else{if(_isUpperCaseShape(d.nWordShape)){if(d.nWordShape==b.aWords[a].nWordForm){f=EWMT_ShapeMatch}else{f=EWMT_NotMatch}}else{if(d.nWordShape==b.aWords[a].nWordForm||d.nWordShape==b.aWords[a].nWordForm-1){f=EWMT_ShapeMatch}else{f=EWMT_WordMatch}}}}if(g<f){g=f}}return g}function _getTermMatchType(k,l,c,e,g){var a=EWMT_ShapeMatch;if(e<0||g<=0||c.length<e+g){return EWMT_NotMatch}var b=l;var d=l;for(var f=e;f<e+g;f++){b=b-c[f].nWordId;d=b+c[f].nWordId;if(!k[d]){return EWMT_NotMatch}var h=_getWordMatchType(c[f],k[d],d,b);if(h<a){a=h}if(a==EWMT_NotMatch){return a}b=b+c[f].strWord.length+c[f].nWordId}return a}function _matchTypeToScore(a){switch(a){case EWMT_NotMatch:return 0;case EWMT_SynonymMatch:return 1;case EWMT_WordMatch:return 2;case EWMT_ShapeMatch:return 4;default:return 0}}function _computeSingleWordScore(d,a){if(!d.aWords[a]){return 0}var b=d.aWords[a].uEmphasis;if(b==0){b=d.aWords[a].uFreq}else{b=_emphasisToScore(b)}var c=_rank_Weaken(_rank_ULaw(b),WEIGHT_OF_SINGLE_WORD_SCORE);if(_isTitle(d.aWords[a].uEmphasis)){return c/3+2/3}if(_isKeyWord(d.aWords[a].uEmphasis)){return c/3+1/3}else{return c/3}}function _computeTermWeight(g,b){var f=b.aWords.length;if(f==0){return -1}var e=0;for(i=0;i<f;i++){e+=_computeSingleWordScore(g,b.aWords[i].nWordId)}if(b.eType==ESNT_PHRASE){var a=false;var d=0;for(var c in g.aTiles){d=parseInt(c);a=_getPhraseMatch(g.aTiles,d,b.aWords,0);if(a){break}}if(a){return e}else{return 0}}else{return e}}function _getPhraseMatch(b,f,g,c){var h=f;if(c>=g.length){return false}if(f>=b.length){return false}var e=g[c].nWordId;if(!b[f]){return false}var d=b[f].aWords[0].nWordId;if(d==e){if(c==(g.length-1)){return true}else{var a=g[c].strWord.length;return _getPhraseMatch(b,f+a,g,c+1)}}else{return false}}function _removeNegativeWeight(a,b){if(a>=0){return a}switch(b){case ESNT_OR:return 0;case ESNT_AND:return 1;case ESNT_NOT:return 0}return 0}function _getWeightOfNode(d,c){if(c==null){return 0}if(c.eType==ESNT_DEFAULT||c.eType==ESNT_PHRASE||c.eType==ESNT_NOT){return _computeTermWeight(d,c)}else{var a=_getWeightOfNode(d,c.right)/2;var b=_getWeightOfNode(d,c.left);if(a<0&&b<0){return -1}a=_removeNegativeWeight(a,c.eType);b=_removeNegativeWeight(b,c.eType);switch(c.eType){case ESNT_OR:return(b+a)/2;case ESNT_AND:return(b*a);case ESNT_NOT:a=(a==0)?1:0;return b*a}return 0}}function calculateRanking(b,a){return _getWeightOfNode(b,a)}function arrayRemoveAt(c,a){var d=c.length;for(var b=a;b<d-1;b++){c[b]=c[b+1]}c.length--}function HuginQueryResult(){this.aTopics=new Array()}function HuginImageWord(){this.uEmphasis=0;this.uFreq=0}function HuginImageTileWord(a,b){this.nWordId=a;this.nWordForm=b}function HuginImageTile(){this.aWords=new Array()}function HuginTopicImage(a){this.aWords=new Array();this.aTiles=new Array()}function HuginHunter(){this.aOdbPathes=null;this.strOdbPath=null;this.strQuery=null;this.queryResult=null;this.bInited=false;this.bSucc=true;this.aDatabases=null;this.iCurProj=null;this.queryExpression=null;this.queryWord=null;this.curTermNode=null;this.aRecordTable=null;this.aSuspendTopics=null;this.aTopics=null;this.iCurTopic=null;this.aTopicImages=null;this.aNodeStack=null;this.iCurTermNodeWord=null;this.aPossibleOrgs=null;this.aRankedTopics=null;this.nWordLoaded=0;this.nWordNum=0;this.nState=0;this.nProgress=0;this.prepareQuery=function(){this.queryResult=null;this.bSucc=true;this.iCurProj=0;this.queryExpression=null;this.queryWord=null;this.curTermNode=null;this.aRecordTable=null;this.aSuspendTopics=null;this.aTopics=null;this.iCurTopic=0;this.aTopicImages=null;this.aNodeStack=null;this.iCurTermNodeWord=0;this.aPossibleOrgs=null;this.aRankedTopics=null;this.nWordLoaded=0;this.nWordNum=0;this.nState=0;this.nProgress=0;for(var a in this.aDatabases){this.aDatabases[a].prepareQuery()}};this.updateProgress=function(){var b=100*this.iCurProj/this.aDatabases.length;var a=100/this.aDatabases.length;if(this.nState==1){this.nProgress=Math.round(b+(this.nWordLoaded/this.nWordNum)*(a/3))}else{if(this.nState==2){this.nProgress=Math.round(b+a/3+(this.iCurTopic/this.aTopics.length)*(a*2/3))}}};this.incCurProjForInit=function(b,a){a.iCurProj++;if(a.iCurProj<a.aDatabases.length){b.push(a.aDatabases[a.iCurProj].init,a.aDatabases[a.iCurProj],a.incCurProjForInit,a)}};this.incCurProjForEvaluate=function(b,a){a.iCurProj++;if(a.iCurProj<a.aDatabases.length){a.aRankedTopics[a.iCurProj]=new Array();b.push(a.getRecords,a,a.evaluateTopics,a,a.getTopicInfo,a,a.incCurProjForEvaluate,a)}};this.incCurTermNodeWord=function(b,a){a.nState=1;a.iCurTermNodeWord++;a.nWordLoaded++;a.updateProgress()};this.incCurTopic=function(b,a){a.nState=2;a.iCurTopic++;a.updateProgress()};this.checkInitSucc=function(e,b){var a=true;var d=false;b.bInited=false;for(var c=0;c<b.aDatabases.length;c++){if(!b.aDatabases[c].bSucc||!b.aDatabases[c].bInited){d=true}else{a=false}}if(a){e.strMsg=gsInitDatabaseFailed;g_CurState=ECS_FATALERROR;updateResultView();return}if(d){e.strMsg=gsInitDatabaseFailed}e.strMsg="";g_CurState=ECS_FTSREADY;b.bInited=true};this.getWordImageToAdd=function(a,b){return b[a]?b[a]:(b[a]=new HuginImageWord())};this.getTileImageToAdd=function(b,a){return a[b]?a[b]:(a[b]=new HuginImageTile())};this.addRecordToRecordTable=function(c,b){if(b==""){return}if(typeof(this.aRecordTable[c])=="undefined"){this.aRecordTable[c]=new Array()}var e=b.split("|");for(var a=0;a<e.length;a++){var d=e[a].match("^(\\d+),(.*)$");if(d==null){continue}this.aRecordTable[c][d[1]]=d[2];this.aSuspendTopics[d[1]]=true}};this.processRecordResult=function(b,a){if(!a.aDatabases[a.iCurProj].bSucc){return}a.wordRecord=a.aDatabases[a.iCurProj].recordResult;a.addRecordToRecordTable(a.queryWord.nWordId,a.wordRecord.strRecord)};this.getRecordOfTermWord=function(b,a){if(a.iCurTermNodeWord>=a.curTermNode.aWords.length){return}a.queryWord=a.curTermNode.aWords[a.iCurTermNodeWord];a.aDatabases[a.iCurProj].queryWord=a.queryWord;a.aDatabases[a.iCurProj].eType=a.curTermNode.eType;a.aDatabases[a.iCurProj].bNeedStopWord=a.bNeedStopWord;b.push(a.aDatabases[a.iCurProj].queryRecord,a.aDatabases[a.iCurProj],a.processRecordResult,a,a.incCurTermNodeWord,a,a.getRecordOfTermWord,a)};this.getRecordOfTermNode=function(b,a){a.aPossibleOrgs=new Array();a.bNeedStopWord=(a.curTermNode.eType==ESNT_PHRASE);a.iCurTermNodeWord=0;b.push(a.getRecordOfTermWord,a)};this.getRecordOfNode=function(c,a){if(a.aNodeStack.length==0){return}var b=a.aNodeStack[a.aNodeStack.length-1];a.aNodeStack.length--;if(b!=null){if(b.eType==ESNT_PHRASE||b.eType==ESNT_DEFAULT||b.eType==ESNT_NOT){a.curTermNode=b;c.push(a.getRecordOfTermNode,a)}else{a.aNodeStack[a.aNodeStack.length]=b.right;a.aNodeStack[a.aNodeStack.length]=b.left;c.push(a.getRecordOfNode,a,a.getRecordOfNode,a)}}};this.addToTopicImage=function(f,e,a){var d=this.getWordImageToAdd(e,f.aWords);d.uEmphasis|=a.uEmphasis;if(a.uEmphasis==0){d.uFreq=a.aPositions.length}for(var c in a.aPositions){var b=this.getTileImageToAdd(a.aPositions[c],f.aTiles);b.aWords[b.aWords.length]=new HuginImageTileWord(e,0)}};this.unpackTopicRecord=function(b){var c=b.split(":");if(c.length==0){return null}var a=new Object();a.uEmphasis=parseInt(c[0]);a.aPositions=c[1].split(",");if(a.aPositions.length<1){return null}return a};this.makeTopicImage=function(d){var b=new HuginTopicImage();for(var c in this.aRecordTable){if(!this.aRecordTable[c][d]){continue}var a=this.unpackTopicRecord(this.aRecordTable[c][d]);this.addToTopicImage(b,parseInt(c),a)}return b};this.calculateRanking=function(a){return calculateRanking(a,this.queryExpression)};this.calculateWordNum=function(a){if(a.eType==ESNT_PHRASE||a.eType==ESNT_DEFAULT||a.eType==ESNT_NOT){this.nWordNum+=a.aWords.length}else{this.calculateWordNum(a.right);this.calculateWordNum(a.left)}};this.getRecords=function(b,a){a.aNodeStack=new Array();a.aNodeStack[a.aNodeStack.length]=a.queryExpression;a.aRecordTable=new Array();a.aSuspendTopics=new Array();a.nWordLoaded=0;a.calculateWordNum(a.queryExpression);b.push(a.getRecordOfNode,a)};this.evaluateTopic=function(c,b){if(b.iCurTopic>=b.aTopics.length){return}var a=new Object();a.fRanking=b.calculateRanking(b.makeTopicImage(b.aTopics[b.iCurTopic]));if(a.fRanking>0){a.nTopicId=parseInt(b.aTopics[b.iCurTopic]);b.aRankedTopics[b.iCurProj][b.aRankedTopics[b.iCurProj].length]=a}c.push(b.incCurTopic,b,b.evaluateTopic,b)};this.evaluateTopics=function(c,a){a.aTopics=new Array();for(var b in a.aSuspendTopics){a.aTopics[a.aTopics.length]=b}a.iCurTopic=0;c.push(a.evaluateTopic,a)};this.createTopicImages=function(b,a){a.aTopicImages=new Array();a.aPossibleOrgs=new Array();a.aNodeStack=new Array();a.aNodeStack[a.aNodeStack.length]=a.queryExpression;b.push(a.addNodeToTopicImages,a)};this.calculateRankings=function(d,b){b.aRankedTopics=new Array();for(var c in b.aTopicImages){var a=new Object();a.fRanking=calculateRanking(b.aTopicImages[c],b.queryExpression);if(a.fRanking<=0){continue}a.nTopicId=parseInt(c);document.writeln("<br>"+a.nTopicId+"<br>");b.aRankedTopics[b.aRankedTopics.length]=a}};this.compRankedTopics=function(c,a){if(c.fRanking>a.fRanking){return true}else{if(c.fRanking==a.fRanking){var b=compare(c.strTitle,a.strTitle);if(b<0){return true}}}return false};this.swapRankedTopics=function(a,c,b){a[c]=b};this.quickSortRankedTopics=function(b,a){quickSort(this.queryResult.aTopics,0,this.queryResult.aTopics.length-1,this.compRankedTopics,this.swapRankedTopics)};this.compPossibleOrgs=function(b,a){if(utf8Compare(b,a)<=0){return true}return false};this.swapPossibleOrgs=function(a,c,b){a[c]=b};this.getTopicInfo=function(b,a){a.aDatabases[a.iCurProj].aQueryTopics=a.aRankedTopics[a.iCurProj];b.push(a.aDatabases[a.iCurProj].queryTopicInfos,a.aDatabases[a.iCurProj])};this.evaluateExpression=function(b,a){a.queryExpression=parseQueryExpression(a.strQuery);if(a.queryExpression==null){b.strMsg=gsInvalidExpression_1;a.bSucc=false;return}a.aRankedTopics=new Array();a.iCurProj=-1;b.push(a.incCurProjForEvaluate,a)};this.makeResult=function(e,b){b.queryResult.aTopics=new Array();if(!b.bSucc){return}var d=0;for(var c=0;c<b.aRankedTopics.length;c++){for(var a=0;a<b.aRankedTopics[c].length;a++){d=b.queryResult.aTopics.length;b.queryResult.aTopics[d]=b.aRankedTopics[c][a];b.queryResult.aTopics[d].strUrl=b.aProjPathes[c].strProjDir+b.queryResult.aTopics[d].strUrl;b.queryResult.aTopics[d].fRanking=b.aRankedTopics[c][a].fRanking}}b.quickSortRankedTopics(0,b.queryResult.aTopics.length-1);for(var c=0;c<b.queryResult.aTopics.length;c++){b.queryResult.aTopics[c].nIndex=c+1}};this.init=function(d,a){a.bInited=false;a.aDatabases=new Array();for(var b in a.aProjPathes){var c=a.aDatabases.length;a.aDatabases[c]=new HuginDatabase();a.aDatabases[c].strOdbPath=a.aProjPathes[b].strOdbPath}if(a.aDatabases.length==0){return}if(gbAIRSSL||mrIsOnEngine()==false){a.iCurProj=0;d.push(a.aDatabases[a.iCurProj].init,a.aDatabases[a.iCurProj],a.incCurProjForInit,a,a.checkInitSucc,a)}};this.query=function(b,a){if(!a.bInited){a.bSucc=false;return}a.prepareQuery();g_CurState=ECS_SEARCHING;updateResultView();a.queryResult=new HuginQueryResult();b.push(a.evaluateExpression,a,a.makeResult,a)}}function getEventX(a){if(gbIE5){return event.x}if(gbNav7||gbAIR){return a.pageX}return 0}function getEventY(a){if(gbIE5){return event.y}if(gbNav7||gbAIR){return a.pageY}return 0}function setInnerHTML(a,b){a.innerHTML=b}function compByTitleDescend(c,a){var b=compare(getInnerText(c.cells[0]),getInnerText(a.cells[0]));if(b>0){return true}else{if(b==0){return compByRank(c,a)}else{return false}}}function compByTitleAscend(c,a){var b=compare(getInnerText(c.cells[0]),getInnerText(a.cells[0]));if(b<0){return true}else{if(b==0){return compByRank(c,a)}else{return false}}return getInnerText(c.cells[0])<=getInnerText(a.cells[0])}function compByRank(b,a){return parseInt(getInnerText(b.cells[2]))<=parseInt(getInnerText(a.cells[2]))}function swapTableNode(b,c,a){b[c].swapNode(a)}function getPartition(e,c,b,f,d){var a=e[c];while(c<b){while(c<b&&f(a,e[b])){b--}if(c<b){d(e,c++,e[b])}while(c<b&&f(e[c],a)){c++}if(c<b){d(e,b--,e[c])}}d(e,c,a);return c}function quickSort(c,e,d,f,a){if(e<d){var b=getPartition(c,e,d,f,a);quickSort(c,e,b-1,f,a);quickSort(c,b+1,d,f,a)}}function updateHeader(){var a=getElement("OdinFtsTitle");var b=getElement("OdinFtsRank");if(a==null||b==null){return}switch(g_nSortType){case 0:setInnerHTML(a,gsTitle);setInnerHTML(b,gsRank+" "+gsAscendFlag);break;case 1:setInnerHTML(a,gsTitle+" "+gsAscendFlag);setInnerHTML(b,gsRank);break;case 2:setInnerHTML(a,gsTitle+" "+gsDescendFlag);setInnerHTML(b,gsRank);break}}function quickSortResult(){var b=getElement("OdinFtsRslt");if(b==null){return}var a=g_nSortType==0?compByRank:g_nSortType==1?compByTitleAscend:compByTitleDescend;quickSort(b.rows,0,b.rows.length-1,a,swapTableNode);updateHeader()}function getStylePropertyValue(b,a){var c=null;if(b.currentStyle){c=b.currentStyle[a]}else{if(window.getComputedStyle){c=document.defaultView.getComputedStyle(b,null).getPropertyValue(a)}}return c}function uiMouseDown(g){var b=gbNav7||gbAIR?g:event;var c=gbNav7||gbAIR?b.target:b.srcElement;if(c.id=="DragSep"){var f=getElement("OdinFtsRank");if(f==null){return}var d=f.style.width;if(d==null||d.length==0){d=getStylePropertyValue(f,"width")}if(d!=null&&d.length>0){if(f.offsetWidth){d=""+f.offsetWidth+"px"}}if(d!=null&&d.length>0){var a=d.match("^(.+)px$");if(a!=null){g_nInitWidth=parseInt(d.match("^(.+)px$")[1]);if(g_nInitWidth.toString()!="NaN"){g_nX0=getEventX(g);g_bDraging=true}}}}else{if(c.id=="OdinFtsTitle"){g_nSortType=g_nSortType!=1?1:2;quickSortResult()}else{if(c.id=="OdinFtsRank"){g_nSortType=0;quickSortResult()}}}}function uiMouseMove(b){var a=getElement("OdinFtsRank");if(a==null){return}if(g_bDraging==true){var c=getEventX(b)-g_nX0;if(g_nInitWidth-c>g_nRankWidthMin){a.style.width=g_nInitWidth-c}}}function uiMouseUp(a){g_bDraging=false}function uiClick(d){var a=gbNav7?d:event;var b=gbNav7?a.target:a.srcElement;if(b.className=="fr_tc"&&b.tagName=="A"){var g=getElement("ActiveLink");if(g!=null){g.id="";g.className="fr_tc"}b.id="ActiveLink";b.className="fr_act"}else{if(gbAIR&&b.className=="sl_page"&&b.tagName=="LI"){var f=b.id;if(f!=null&&f.length>0){var c=parseInt(b.id);onClickPage(c)}}}}if(!gbIE&&(gbNav7||gbAIR||gbSafari)){Node.prototype.swapNode=function(b){var c=this.nextSibling;var a=this.parentNode;b.parentNode.insertBefore(this,b);a.insertBefore(b,c)};document.captureEvents(Event.MOUSEMOVE|Event.MOUSEDOWN|Event.MOUSEUP|Event.CLICK)}function loadFts(){if(!gbReady){var c=new whMessage(WH_MSG_GETPROJINFO,this,1,null);if(SendMessage(c)&&c.oParam){gbReady=true;var d=c.oParam;var a=d.aProj;gbXML=d.bXML;if(a&&a.length>0){context=new HuginContext();goOdinHunter=new HuginHunter();goOdinHunter.aProjPathes=new Array();for(var b in a){goOdinHunter.aProjPathes[b]=new Object();goOdinHunter.aProjPathes[b].strProjDir=a[b].sPPath;goOdinHunter.aProjPathes[b].strOdbPath=a[b].sPPath+a[b].sDPath+a[b].sFts}context.reset();context.push(goOdinHunter.init,goOdinHunter,registListener,this);context.resume()}}}}var gbAIRMergeArray;function GetMergeProjectArray(){try{if(gbAIR){return gbAIRMergeArray}else{if(gbAIRSSL){if(this.window.parent.parent.gbAIRmergeProjectArray!=null){return this.window.parent.parent.gbAIRmergeProjectArray}}}}catch(a){}return null}function loadFts_context(b,d){var c=GetMergeProjectArray();goOdinHunter=new HuginHunter();goOdinHunter.aProjPathes=new Array();goOdinHunter.aProjPathes[0]=new Object();goOdinHunter.aProjPathes[0].strProjDir=b;goOdinHunter.aProjPathes[0].strOdbPath=goOdinHunter.aProjPathes[0].strProjDir+"whxdata/whfts.xml";if(c!=null){var a=0;while(a<c.length){goOdinHunter.aProjPathes[a+1]=new Object();goOdinHunter.aProjPathes[a+1].strProjDir=c[a];goOdinHunter.aProjPathes[a+1].strOdbPath=c[a]+"whxdata/whfts.xml";a++}}context=new HuginContext();context.reset();context.push(goOdinHunter.init,goOdinHunter,registListener,this);context.resume()}function Query(){gbAIRSearchString=goOdinHunter.strQuery;g_CurPage=1;context=new HuginContext();context.reset();context.push(goOdinHunter.query,goOdinHunter,processHunterResult,null);context.resume()}function changeResultView(c){var a=getElement(gsResultDivID);if(a){var b=getParentNode(a);if(!b){return}a.innerHTML=c}else{document.body.innerHTML=c}}function displayMsg(b){if(!gbAIRSSL){var a=new whMessage(WH_MSG_SETNUMRSLT,this,1,0);SendMessage(a)}changeResultView("<P CLASS='msg'>"+b+"</P>")}function writeTableHead(){if(gbAIRSSL){return"<TABLE CELLSPACING=0 CEllPADDING=0 STYLE='table-layout:fixed; width:100%'><THEAD><TR STYLE='font-weight:bold'><TD ID='OdinFtsTitle'	CLASS='fr_tt' STYLE='cursor:pointer'>"+gsTitle+"</TD><TD ID='DragSep'		CLASS='fr_ts' STYLE='cursor:w-resize; width:4px'>&nbsp;</TD><TD ID='OdinFtsRank'	CLASS='fr_tt' STYLE='cursor:pointer; width:60px'>"+gsRank+"^</TD></TR></THEAD><TBODY ID='OdinFtsRslt'>"}return"<TABLE CELLSPACING=0 CEllPADDING=0 STYLE='table-layout:fixed; width:110%'><THEAD><TR STYLE='font-weight:bold'><TD ID='OdinFtsTitle'	CLASS='fr_tt' STYLE='cursor:pointer'>"+gsTitle+"</TD><TD ID='DragSep'		CLASS='fr_ts' STYLE='cursor:w-resize; width:4px'>&nbsp;</TD><TD ID='OdinFtsRank'	CLASS='fr_tt' STYLE='cursor:pointer'>"+gsRank+"^</TD></TR></THEAD><TBODY ID='OdinFtsRslt'>"}function writeResult(g,f,d,a,b,e){var c="";if(e.length>0){c="<TR><TD CLASS='fr_tc'><A CLASS='fr_tc' HREF='"+g+"'>"+_textToHtml_nonbsp(d)+"</A><div>"+_textToHtml_nonbsp(e)+"</div><br></TD><TD CLASS='fr_tc'>&nbsp;</TD><TD CLASS='fr_tc' STYLE='text-align:center'>"+b+"</TD></TR>"}else{c="<TR><TD CLASS='fr_tc'><A CLASS='fr_tc' STYLE='font-weight:normal;' HREF='"+g+"'>"+_textToHtml_nonbsp(d)+"</A></TD><TD CLASS='fr_tc'>&nbsp;</TD><TD CLASS='fr_tc' STYLE='text-align:center'>"+b+"</TD></TR>"}return c}function writeTableTail(){return"</TBODY></TABLE>"}function HandleAIRSearchFunction(){if(gAIRSearchObject!=undefined&&gAIRSearchObject.displayFunction!=undefined){gAIRSearchObject.displayFunction();return}}function displayTopics(p){HandleAIRSearchFunction();var k="";var g="";var c=gbAIRSearchString;var o="CLRF="+gsHLColorFront+",CLRB="+gsHLColorBackground+",HL=";var f=10;if(gbAIRSSL){f=25}if(!gbAIRSSL){var d=new whMessage(WH_MSG_GETMAXRSLT,this,1,null);if(SendMessage(d)){f=d.oParam}}var l=0;if(g_CurPage<1){g_CurPage=1}if(p!=null){if(!gbAIRSSL){var d=new whMessage(WH_MSG_SETNUMRSLT,this,1,p.aTopics.length);SendMessage(d)}k+=writeTableHead();if(gbHighLight){var n;n="?";if(gbAIRSSL){n+='searchhighlightTextStringRoboHelp="';if(gbAIRSynonymString!=null&&gbAIRSynonymString.length>0){c+=gbAIRSynonymString}}o=n+escape(c)+'"'}else{o=""}for(l=(g_CurPage-1)*f;(l<p.aTopics.length)&&(l<(g_CurPage*f));l++){var b=p.aTopics[l].strUrl;if(gbAIRSSL){b+=o}g+=writeResult(b,o,p.aTopics[l].strTitle,getFontStyle(goFont),p.aTopics[l].nIndex,p.aTopics[l].strSummary);if(l&15==0){k+=g;g=""}}if(g.length>0){k+=g}k+=writeTableTail();var m=Math.ceil(p.aTopics.length/f);var a="";var h;if(m>1){k+='<div><ul style="list-style:none; margin:0; padding:0" >';if(g_CurPage>1){a+="<li class='sl_page' id='"+(g_CurPage-1).toString()+"' onMouseOver=\"this.className='sl_pageC'\" onMouseOut=\"this.className='sl_page'\" onclick=\"onClickPage("+(g_CurPage-1).toString()+')">&lt;&lt;</li>'}var e="sl_page";for(h=g_CurPage;h<=m&&h<=(g_CurPage+g_nMaxPages);h++){if(h==g_CurPage){e="sl_pageC"}else{e="sl_page"}a+="<li class='"+e+"' id='"+h.toString()+"' onMouseOver=\"this.className='sl_pageC'\" onMouseOut=\"this.className='"+e+'\'" onclick="onClickPage('+h+')">'+h.toString()+"</li>"}if(g_CurPage!=m){a+="<li class='sl_page' id='"+(g_CurPage+1).toString()+"' onMouseOver=\"this.className='sl_pageC'\" onMouseOut=\"this.className='sl_page'\" onclick=\"onClickPage("+(g_CurPage+1).toString()+')">&gt;&gt;</li>'}k+=a;k+="</ul></div>"}}if(p.aTopics.length==0){k="<P CLASS='msg'>"+gsNoTopics+"</P>"}else{k="<dl>"+k+"</dl>"}changeResultView(k);if(gbAIR){quickSortResult();if(gbAIRSearchResultDisplayDoneFn!=null){gbAIRSearchResultDoneSteps++;if(gbAIRSearchResultDoneSteps>0){gbAIRSearchResultDone=true;gbAIRSearchResultDoneSteps=0;gbAIRSearchResultDisplayDoneFn()}}}else{setTimeout("quickSortResult();",1)}}function dummySearchResultFn(){}function onClickPage(a){g_CurPage=a;g_CurState=ECS_FOUND;updateResultView()}function displaySearchProgressBar(a){var b=getElement("SearchProgressBar");var d=getElement("SearchProgress");if(!b||!d){var c="<P ID='SearchProgress' CLASS='pb_tt'>"+gsSearching+" "+a+"%</P>\n<DIV CLASS='pb_out'>\n<P ID='SearchProgressBar' CLASS='pb_in' STYLE='width:"+a+"%'></P>\n</DIV>\n<CENTER><P CLASS='pb_cancel' ONMOUSEDOWN='context.stop()'>"+gsCancel+"</P></CENTER>\n";changeResultView(c)}else{setInnerHTML(d,gsSearching+" "+a+"%");b.style.width=a+"%"}}function updateResultView(){if(g_CurState==ECS_SEARCHING){displaySearchProgressBar(goOdinHunter.nProgress)}else{if(g_CurState==ECS_FOUND){displayTopics(goOdinHunter.queryResult)}else{if(g_CurState==ECS_SEARCHFAILED){displayMsg(context.strMsg)}else{if(g_CurState==ECS_FATALERROR){displayMsg(context.strMsg)}else{if(g_CurState==ECS_CANCELED){displayMsg(gsCanceled)}}}}}if(g_CurState==ECS_SEARCHFAILED||g_CurState==ECS_FATALERROR||g_CurState==ECS_CANCELED){HandleAIRSearchFunction()}}function processHunterResult(a){if(a){updateResultView();if(gbAIR){processHunterResult()}else{setTimeout("processHunterResult();",1)}return}if(goOdinHunter==null){return}if(!goOdinHunter.bSucc){g_CurState=ECS_SEARCHFAILED;updateResultView();return}g_CurState=ECS_FOUND;updateResultView()}function GetSearchTextFromURL(){var a=document.location.href;var c=a.indexOf("%22");var d=a.lastIndexOf("%22");var b="";if(c!=-1&&d!=-1){b=a.substring(c+3,d)}if(c==-1&&d==-1){c=a.indexOf('"');d=a.lastIndexOf('"');if(c!=-1&&d!=-1){b=a.substring(c+1,d)}}b=decodeURIComponent(b);b=unescape(b);b=b.toUpperCase();return b}function setSearchDisplayFunction(a){gAIRSearchObject=new Object();gAIRSearchObject.displayFunction=a}if(gbAIRSSL||!window.gbTesting){if(window.gbWhUtil&&window.gbWhLang&&window.gbWhVer&&(window.gbAIRSSL||(window.gbWhProxy&&window.gbWhMsg))){goFont=new whFont("Verdana","8pt","#000000","normal","normal","none");goErrFont=new whFont("Verdana","8pt","#000000","normal","bold","none");goHoverFont=new whFont("Verdana","8pt","#007f00","normal","normal","underline");if(!gbAIR){window.onload=window_OnLoad}window.onbeforeunload=window_BUnload;window.onunload=window_Unload;if(!gbAIRSSL){RegisterListener2(this,WH_MSG_PROJECTREADY)}gbWhFHost=true}else{document.location.reload()}}function utf8Compare(d,c){var b=d;var a=c;try{b=d.toLowerCase()}catch(e){}try{a=c.toLowerCase()}catch(e){}if(b<a){return -1}if(b>a){return 1}return 0}document.onmousedown=uiMouseDown;document.onmousemove=uiMouseMove;document.onmouseup=uiMouseUp;document.onclick=uiClick;if(typeof(Sys)!=="undefined"){Sys.Application.notifyScriptLoaded()};