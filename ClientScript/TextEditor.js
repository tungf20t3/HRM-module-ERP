CreateTextEditor = function (n, t, i) { var r = this, u; return container = $(String.format("#{0}", n)), i ? new TextEditor(container, t, { controls: i }) : new TextEditor(container, t, { controls: "font size | bold italic underline strikethrough subscript superscript | color highlight removeformat | alignleft center alignright justify | bullets numbering | outdent indent | link unlink" }) }; TextEditor = function (n, t, i) { var r = this, u; return r._form = t, r.defaultOptions = { width: "auto", height: 250, controls: "bold italic underline strikethrough subscript superscript | font size style | color highlight removeformat | bullets numbering | outdent indent | alignleft center alignright justify | undo redo | rule image link unlink", colors: "FFF FCC FC9 FF9 FFC 9F9 9FF CFF CCF FCF CCC F66 F96 FF6 FF3 6F9 3FF 6FF 99F F9F BBB F00 F90 FC6 FF0 3F3 6CC 3CF 66C C6C 999 C00 F60 FC3 FC0 3C0 0CC 36F 63F C3C 666 900 C60 C93 990 090 399 33F 60C 939 333 600 930 963 660 060 366 009 339 636 000 300 630 633 330 030 033 006 309 303", fonts:"Inter,Arial Black,Comic Sans MS,Courier New,Narrow,Garamond,Georgia,Impact,Sans Serif,Serif,Inter,Trebuchet MS,Inter",sizes:"1,2,3,4,5,6,7",styles:[["Paragraph","<p>"],["Header 1","<h1>"],["Header 2","<h2>"],["Header 3","<h3>"],["Header 4","<h4>"],["Header 5","<h5>"],["Header 6","<h6>"]],useCSS:!0,docCSSFile:"",bodyStyle:"margin:4px; font:11px Inter; font-color:#444; cursor:text"},r.buttons={init:"bold,1,|italic,2,|underline,3,|strikethrough,4,|subscript,5,|superscript,6,|font,7,fontname,|size,8,fontsize,|style,9,formatblock,|color,10,forecolor,|highlight,11,hilitecolor,color|removeformat,12,|bullets,13,insertunorderedlist|numbering,14,insertorderedlist|outdent,15,|indent,16,|alignleft,17,justifyleft|center,18,justifycenter|alignright,19,justifyright|justify,20,justifyfull|undo,21,|redo,22,|rule,23,inserthorizontalrule|image,24,insertimage,url|link,25,createlink,url|unlink,26,"},$.each(r.buttons.init.split("|"),function(n,t){var i=t.split(","),u=i[0];r.buttons[u]={stripIndex:n,name:u,title:r.getUILabel(i[1]),command:i[2]===""?u:i[2],popupName:i[3]===""?u:i[3]}}),delete r.buttons.init,u=navigator.userAgent.toLowerCase(),r.ie=/msie/.test(u),r.ie6=/msie\s6/.test(u),r.iege11=/(trident)(?:.*rv:([\w.]+))?/.test(u),r.webkit=/t.webkit/.test(u),r.iOS=/iPhone|iPad|iPod/i.test(u),r.documentClickAssigned=!1,r.init(n,i),r};var methods=[["clear",TextEditor.prototype.clear],["disable",TextEditor.prototype.disable],["execCommand",TextEditor.prototype.execCommand],["focus",TextEditor.prototype.focus],["hidePopups",TextEditor.prototype.hidePopups],["sourceMode",TextEditor.prototype.sourceMode,!0],["refresh",TextEditor.prototype.refresh],["select",TextEditor.prototype.select],["selectedHTML",TextEditor.prototype.selectedHTML,!0],["selectedText",TextEditor.prototype.selectedText,!0],["showMessage",TextEditor.prototype.showMessage],["updateFrame",TextEditor.prototype.updateFrame],["updateTextArea",TextEditor.prototype.updateTextArea]],popups={};$.each(methods,function(n,t){TextEditor.prototype[t[0]]=function(){for(var u,n=this,r=[n],i=0;i<arguments.length;i++)r.push(arguments[i]);return(u=t[1].apply(n,r),t[2])?u:n}});TextEditor.prototype={init:function(n,t){var i=this,s=n[0].parentNode.parentNode;s.style.value="overflow:hidden;width:100%;padding:3px!important;";i._container=$(n);i.options=t=$.extend({},i.defaultOptions,t);var f=i.$area=$(n).css({border:"none",margin:0,padding:0}).hide().data("TextEditor",i).blur(function(){i.updateFrame(!0)}),e=i.$main=$("<div>").addClass("TextEditorMain").width(t.width).height(t.height),o=i.$toolbar=$("<div>").addClass("TextEditorToolbar").appendTo(e),r=$("<div>").addClass("TextEditorGroup").appendTo(o),u=0;$.each(t.controls.split(" "),function(n,f){var c,e,h,s;if(f==="")return!0;f==="|"?(c=$("<div>").addClass("TextEditorDivider").appendTo(r),r.width(u+1),u=0,r=$("<div>").addClass("TextEditorGroup").appendTo(o)):(e=i.buttons[f],h=$("<div>").data("buttonName",e.name).addClass("TextEditorButton").attr("title",e.title).bind("click",$.proxy(i.buttonClick,i)).appendTo(r).hover(i.hoverEnter,i.hoverLeave),u+=24,r.width(u+1),s={},e.css?s=e.css:e.image&&(s.backgroundImage=i.imageUrl(e.image)),e.stripIndex&&(s.backgroundPosition=e.stripIndex*-24),h.css(s),i.ie&&h.attr("unselectable","on"),e.popupName&&i.createPopup(e.popupName,t,e.popupClass,e.popupContent,e.popupHover))});e.insertBefore(f).append(f);i.documentClickAssigned||($(document).click(function(n){var t=$(n.target);t.add(t.parents()).is(".TextEditorPrompt")||i.hidePopups()}),i.documentClickAssigned=!0);i.refresh()},getMailBody:function(){var t=this,n=$("#TextEditorIFrame").contents().find("body")[0];return n?n.innerHTML:""},setMailBody:function(n){var i=this,t=$("#TextEditorIFrame").contents().find("body")[0];t&&(t.innerHTML=n)},blurred:function(n){var t=$(this);return n?t.bind("blurred",n):t.trigger("blurred")},change:function(n){var t=$(this);return n?t.bind("change",n):t.trigger("change")},focused:function(n){var t=$(this);return n?t.bind("focused",n):t.trigger("focused")},buttonClick:function(n){var t=this,i=n.target,u=$.data(i,"buttonName"),f=t.buttons[u],e=f.popupName,s=popups[e],r,o;if(!t.disabled&&$(i).attr("disabled")!=="disabled"){if(r={editor:t,button:i,buttonName:u,popup:s,popupName:e,command:f.command,useCSS:t.options.useCSS},f.buttonClick&&f.buttonClick(n,r)===!1)return!1;if(u==="source")t.sourceMode()?(delete t.range,t.$area.hide(),t.$frame.show(),i.title=f.title):(t.$frame.hide(),t.$area.show(),i.title=t.getUILabel("40"));else if(!t.sourceMode()){if(e){if(o=$(s),e==="url"){if(u==="link"&&t.selectedText()==="")return t.showMessage(t.getUILabel("44"),i),!1;o.children(":button").unbind("click").bind("click",function(){var n=o.find(":text"),i=$.trim(n.val());i!==""&&t.execCommand(r.command,i,null,r.button);n.val("http://");t.hidePopups();t.focus()})}else e==="pastetext"&&o.children(":button").unbind("click").bind("click",function(){var n=o.find("textarea"),i=n.val().replace(/\n/g,"<br />");i!==""&&t.execCommand(r.command,i,null,r.button);n.val("");t.hidePopups();t.focus()});return i!==$.data(s,"button")?(t.showPopup(s,i),!1):void 0}if(u==="print")t.$frame[0].contentWindow.print();else if(!t.execCommand(r.command,r.value,r.useCSS,i))return!1}t.focus()}},hoverEnter:function(n){var t=$(n.target).closest("div");t.css("backgroundColor",t.data("buttonName")?"#CEE7F5":"#EAF5F9")},hoverLeave:function(n){$(n.target).closest("div").css("backgroundColor","transparent")},popupClick:function(n){var t=this,e=n.data.popup,i=n.target,f;if(e!==popups.msg&&!$(e).hasClass("TextEditorPrompt")){var s=$.data(e,"button"),r=$.data(s,"buttonName"),o=t.buttons[r],h=o.command,u,c=t.options.useCSS;if(r==="font"?u=i.style.fontFamily.replace(/"/g,""):r==="size"?(i.tagName.toUpperCase()==="DIV"&&(i=i.children[0]),u=i.innerHTML):r==="style"?u="<"+i.tagName+">":r==="color"?u=t.hex(i.style.backgroundColor):r==="highlight"&&(u=t.hex(i.style.backgroundColor),t.ie?h="backcolor":c=!0),f={editor:t,button:s,buttonName:r,popup:e,popupName:o.popupName,command:h,value:u,useCSS:c},!o.popupClick||o.popupClick(n,f)!==!1){if(f.command&&!t.execCommand(f.command,f.value,f.useCSS,s))return!1;t.hidePopups();t.focus()}}},checksum:function(n){for(var t=1,i=0,r=0;r<n.length;++r)t=(t+n.charCodeAt(r))%65521,i=(i+t)%65521;return i<<16|t},clear:function(){var n=this;n.$area.val("");n.updateFrame()},createPopup:function(n,t,i,r,u){var e=this,f,o;return popups[n]?popups[n]:(f=$("<div>").hide().addClass("TextEditorPopup").appendTo("body"),r?f.html(r):n==="color"?(o=t.colors.split(" "),o.length<10&&f.width("auto"),$.each(o,function(n,t){$("<div>").appendTo(f).css("backgroundColor","#"+t)}),i="TextEditorColor"):n==="font"?$.each(t.fonts.split(","),function(n,t){$("<div>").appendTo(f).css("fontFamily",t).html(t)}):n==="size"?$.each(t.sizes.split(","),function(n,t){$("<div>").appendTo(f).html('<font size="'+t+'">'+t+"<\/font>")}):n==="style"?$.each(t.styles,function(n,t){$("<div>").appendTo(f).html(t[1]+t[0]+t[1].replace("<","<\/"))}):n==="url"?(f.html(String.format('<label><div style="padding-bottom:4px;">{0}<\/div><input type="text" value="http://" style="width:268px" /><\/label><br /><input class="TextEditorPromptButton" type="button" value="{1}" />',e.getUILabel("41"),e.getUILabel("43"))),i="TextEditorPrompt"):n==="pastetext"&&(f.html(String.format('<label>{0}<br /><textarea rows="3" style="width:268px"><\/textarea><\/label><br /><input type="button" value="{1}" />',e.getUILabel("42"),e.getUILabel("43"))),i="TextEditorPrompt"),i||r||(i="TextEditorList"),f.addClass(i),e.ie&&f.attr("unselectable","on").find("div,font,p,h1,h2,h3,h4,h5,h6").attr("unselectable","on"),(f.hasClass("TextEditorList")||u===!0)&&f.children().hover(e.hoverEnter,e.hoverLeave),popups[n]=f[0],f[0])},disable:function(n){var t=this;n?(t.$area.attr("disabled","disabled"),t.disabled=!0):(t.$area.removeAttr("disabled"),delete t.disabled);try{t.ie?t.doc.body.contentEditable=!n:t.doc.designMode=n?"off":"on"}catch(i){}t.refreshButtons()},execCommand:function(n,t,i,r){var u=this,s,o,f,e,h;if(u.restoreRange(),u.ie||((i===undefined||i===null)&&(i=u.options.useCSS),u.doc.execCommand("styleWithCSS",0,i.toString())),s=n.toLowerCase()==="inserthtml",u.ie&&s)u.getRange().pasteHTML(t);else if(u.iege11&&s)o=u.getSelection(),f=o.getRangeAt(0),f.deleteContents(),f.insertNode(f.createContextualFragment(t)),o.removeAllRanges(),o.addRange(f);else{e=!0;try{e=u.doc.execCommand(n,0,t||null)}catch(c){h=c.message;e=!1}e||("cutcopypaste".indexOf(n)>-1?u.showMessage("For security reasons, your browser does not support the "+n+" command. Try using the keyboard shortcut or context menu instead.",r):u.showMessage(h?h:"Error executing the "+n+" command.",r))}return u.refreshButtons(),u.updateTextArea(!0),e},focus:function(){var n=this;setTimeout(function(){n.sourceMode()?n.$area.focus():n.$frame[0].contentWindow.focus();n.refreshButtons()},0)},getRange:function(){var n=this;return n.ie?n.getSelection().createRange():n.getSelection().getRangeAt(0)},getSelection:function(){var n=this;return n.ie?n.doc.selection:n.$frame[0].contentWindow.getSelection()},hex:function(n){var i=/rgba?\((\d+), (\d+), (\d+)/.exec(n),t;if(i){for(n=(i[1]<<16|i[2]<<8|i[3]).toString(16);n.length<6;)n="0"+n;return"#"+n}return(t=n.split(""),n.length===4)?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:n},hidePopups:function(){$.each(popups,function(n,t){$(t).hide().unbind("click").removeData("button")})},imagesPath:function(){var n=$("link[href*=TextEditor]").attr("href");return n.replace(/^(.*\/)[^\/]+$/,"$1")+"images/"},imageUrl:function(){return"url("+this.imagesPath()+filename+")"},refresh:function(){var n=this,u=n.$main,i=n.options;n.$frame&&n.$frame.remove();var t=n.$frame=$('<iframe id="TextEditorIFrame" frameborder="0" src="javascript:true"/>').hide().appendTo(u),e=t[0].contentWindow,r=n.doc=e.document,f=$(r);r.open();r.write("<html>"+(i.docCSSFile===""?"":'<head><link rel="stylesheet" type="text/css" href="'+i.docCSSFile+'" /><\/head>')+'<body id="TextEditorHTMLContent" style="'+i.bodyStyle+'"><\/body><\/html>');r.close();(n.ie||n.iege11)&&f.click(function(){n.focus()});n.updateFrame();n.ie||n.iege11?(f.bind("beforedeactivate beforeactivate selectionchange keypress keyup",function(t){if(t.type==="beforedeactivate")n.inactive=!0;else if(t.type==="beforeactivate")!n.inactive&&n.range&&n.range.length>1&&n.range.shift(),delete n.inactive;else if(!n.inactive)for(n.range||(n.range=[]),n.range.unshift(getRange());n.range.length>2;)n.range.pop()}),t.focus(function(){n.restoreRange();$(n).triggerHandler("focused")}),t.blur(function(){$(n).triggerHandler("blurred")})):$(t[0].contentWindow).focus(function(){$(n).triggerHandler("focused")}).blur(function(){$(n).triggerHandler("blurred")});f.click(n.hidePopups).keydown(function(t){n.ie&&n.getSelection().type=="Control"&&t.keyCode==8&&(n.getSelection().clear(),t.preventDefault())}).bind("keyup mouseup",function(){n.refreshButtons();n.updateTextArea(!0)});n.iOS?n.$area.show():t.show();$(function(){var f=n.$toolbar,e=f.children("div:last"),o=u.width(),r=e.offset().top+e.outerHeight()-f.offset().top+1;f.height(r-2);r=(/%/.test(""+i.height)?u.height():parseInt(i.height,10))-r;t.width(o).height(r);n.$area.width(o).height(n.ie6?r-2:r);n.disable(n.disabled);n.refreshButtons()})},refreshButtons:function(){var n=this,t,i;n.iOS||!n.webkit||n.focused||(n.$frame[0].contentWindow.focus(),window.focus(),n.focused=!0);t=n.doc;n.ie&&(t=n.getRange());i=n.sourceMode();$.each(n.$toolbar.find(".TextEditorButton"),function(r,u){var s=$(u),f=n.buttons[$.data(u,"buttonName")],e=f.command,o=!0,h;if(n.disabled)o=!1;else if(f.getEnabled)h={editor:n,button:u,buttonName:f.name,popup:popups[f.popupName],popupName:f.popupName,command:f.command,useCSS:n.options.useCSS},o=f.getEnabled(h),o===undefined&&(o=!0);else if((i||n.iOS)&&f.name!=="source"||n.ie&&(e==="undo"||e==="redo"))o=!1;else if(e&&e!=="print"&&(n.ie&&e==="hilitecolor"&&(e="backcolor"),!n.ie&&!n.iege11||e!=="inserthtml"))try{o=t.queryCommandEnabled(e)}catch(c){o=!1}o?(s.removeClass("TextEditorDisabled"),s.removeAttr("disabled")):(s.addClass("TextEditorDisabled"),s.attr("disabled","disabled"))})},restoreRange:function(){var n=this;n.range&&(n.ie?n.range[0].select():n.iege11&&n.getSelection().addRange(n.range[0]))},select:function(){var n=this;setTimeout(function(){n.sourceMode()?n.$area.select():n.execCommand("selectall")},0)},selectedHTML:function(){var t=this,i,n,r;return(t.restoreRange(),i=t.getRange(),t.ie)?i.htmlText:(n=$("<layer>")[0],n.appendChild(i.cloneContents()),r=n.innerHTML,n=null,r)},selectedText:function(){var n=this;return(n.restoreRange(),n.ie)?n.getRange().text:n.getSelection().toString()},showMessage:function(n,t){var i=this,r=i.createPopup("msg",i.options,"TextEditorMsg");r.innerHTML=n;i.showPopup(r,t)},showPopup:function(n,t){var r=this,i,e,o,u=$(n),s,f;t?(s=$(t),i=s.offset(),e=--i.left,o=i.top+s.height()):(f=r.$toolbar,i=f.offset(),e=Math.floor((f.width()-u.width())/2)+i.left,o=i.top+f.height()-2);r.hidePopups();u.css({left:e,top:o+1}).show();t&&($.data(n,"button",t),u.bind("click",{popup:n},$.proxy(r.popupClick,r)));setTimeout(function(){u.find(":text,textarea").eq(0).focus().select()},100)},sourceMode:function(){return this.$area.is(":visible")},updateFrame:function(n){var t=this,r=t.$area.val(),e=t.options,u=e.updateFrame,o=$(t.doc.body),f,i;if(u){if(f=t.checksum(r),n&&t.areaChecksum===f)return;t.areaChecksum=f}i=u?u(r):r;i=i.replace(/<(?=\/?script)/ig,"&lt;");e.updateTextArea&&(t.frameChecksum=t.checksum(i));i!==o.html()&&(o.html(i),$(t).triggerHandler("change"))},updateTextArea:function(n){var t=this,r=$(t.doc.body).html(),e=t.options,u=e.updateTextArea,o=t.$area,f,i;if(u){if(f=t.checksum(r),n&&t.frameChecksum===f)return;t.frameChecksum=f}i=u?u(r):r;e.updateFrame&&(t.areaChecksum=t.checksum(i));i!==o.val()&&(o.val(i),$(t).triggerHandler("change"))},getUILabel:function(n){var i=this,t=i._form._language.toLowerCase()=="v";switch(n){case"1":return t?"Đậm":"Bold";case"2":return t?"Nghiêng":"Italic";case"3":return t?"Gạch dưới":"Underline";case"4":return t?"Gạch ngang chữ":"Strikethrough";case"5":return t?"Chỉ số dưới":"Subscript";case"6":return t?"Chỉ số trên":"Superscript";case"7":return t?"Phông":"Font";case"8":return t?"Cỡ phông":"Font Size";case"9":return t?"Kiểu":"Style";case"10":return t?"Màu phông":"Font Color";case"11":return t?"Màu tô văn bản":"Text Highlight Color";case"12":return t?"Bỏ định dạng":"Remove Format";case"13":return t?"Đánh dấu đầu dòng":"Bullets";case"14":return t?"Đánh số":"Numbering";case"15":return t?"Giảm thụt lề":"Decrease Indent";case"16":return t?"Tăng thụt lề":"Increase Indent";case"17":return t?"Căn trái văn bản":"Align Left";case"18":return t?"Căn giữa":"Center";case"19":return t?"Căn phải văn bản":"Align Right";case"20":return t?"Căn đều":"Justify";case"25":return t?"Chèn liên kết trang":"Insert Hyperlink";case"26":return t?"Xóa liên kết trang":"Remove Hyperlink";case"40":return t?"Hiển thị nội dung":"Show Rich Text";case"41":return t?"Nhập liên kết:":"Enter URL:";case"42":return t?"Dán nội dung của bạn ở đây:":"Paste your content here:";case"43":return t?"Nhận":"Submit";case"44":return t?"Hãy chọn nội dung cần chèn liên kết.":"A selection is required when inserting a link.";default:""}}}